Реализация в УНФ
================

Функционал работы с Artix со стороны УНФ реализован с помощью:

1. Расширения **"крюВыгрузкаАртикс"**. Расширение учитывает следующие виды документов

     #) Поступление товаров 
     #) Списание товаров 
     #) Оприходование товаров 
     #) Перемещение товаров 
     #) Возврат товаров поставщику
     #) Отчет о розничных продажах 

В расширении для формы документа реализована процедура "ПослеЗаписиНаСервере"  с аннотацией **"&После"**,
что позволяет выполниться коду из расширения, после выполнения основного кода данной процедуры формы.
Реализовано для того, что бы изменения остатков фиксировались только при интерактивном проведении документа и
не и не отрабатывались при проведении программном.

.. code-block:: Python

     крюОбменСArtixСервер.БылоИзменениеУчетногоКоличества(ТекущийОбъект, ПараметрыЗаписи);

Вызывается процедура **"БылоИзменениеУчетногоКоличества"** общего модуля **"крюОбменСArtixСервер"** 


.. code-block:: Python

     Процедура БылоИзменениеУчетногоКоличества(ТекущийОбъект, ПараметрыЗаписи) Экспорт 
     	Если ПараметрыЗаписи.РежимЗаписи = РежимЗаписиДокумента.Проведение ИЛИ ПараметрыЗаписи.РежимЗаписи = РежимЗаписиДокумента.ОтменаПроведения Тогда
	     	Если ТекущийОбъект.Ссылка.Метаданные().Имя = "ПеремещениеЗапасов" Тогда
		     	ЗаписатьФлагИзменений(ТекущийОбъект.СтруктурнаяЕдиница);		  
		     	ЗаписатьФлагИзменений(ТекущийОбъект.СтруктурнаяЕдиницаПолучатель);		  
		     Иначе
			     ЗаписатьФлагИзменений(ТекущийОбъект.СтруктурнаяЕдиница);		  
		     КонецЕсли;	
	     КонецЕсли;
     КонецПроцедуры	

Процедура проверяет режим записи документа и тип и вызывает функцию **"ЗаписатьФлагИзменений"**, для
записи файла флага в каталог с имя которого совпадает с номером магазина переданного документа.

.. code-block:: Python

     Функция ЗаписатьФлагИзменений(Магазин) Экспорт  
     	НомерМагазина = ПолучитьНомерМагазина(Магазин);
     	ПутьКФайлам	= Справочники.крю_Настройки.ВернутьЗначениеНастройки("КаталогКонтроляОбменаArtix"); 
     	ПрефиксФайла = Формат(ТекущаяДата() - дата(1970,1,1,1,0,0), "ЧГ=0");
     	ИмяФайлаВыгрузки =ПутьКФайлам+ НомерМагазина +  "\" + ПрефиксФайла + "_chg.flg";    
     	ТекстовыйФайл = Новый ТекстовыйДокумент;
     	ТекстовыйФайл.Записать(
          	ИмяФайлаВыгрузки // путь для сохранения
     	);
     	Возврат Неопределено;
     КонецФункции

     
2. Http-сервисы:
     
     
     :ref:`Http-сервис Workshift`

     :ref:`GetChangeShop`

     :ref:`GetProductRemains`


3. Фоновых заданий и обработок

     Обработка поформированию ОРП подключается в дополнительные обработки и для нее настраивается расписание запуска.
     Обоаботка ищет непроведенные документы ОРП, которые связаны с документом "Кассовая смена", со статусом "Закрыта". 
     И выполняет заполнение этих документов продажами из таблиц базы данных "Кассового сервера" Artix, подключенными в программу, как
     внешние источники данных.

Настройки публикации базы

.. figure:: images/web.png


.. :doc:`http1`     