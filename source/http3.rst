:orphan:

.. _GetProductRemains:

GetProductRemains
-----------------

Сервис возвращает номенклатуру и остатки если это предусмотрено настройками номенклатуры, по номеру магазина переданному в параметре.

**Пример запроса**

::

    http://192.168.252.250:8082/unf_vz_const/hs/test_s/V1/GetProductRemains?number=test

**Структура запроса**

::    

    http://{Адрес сервера}/{Имя БД}/hs/{Имя}/V1/{Параметр}

Где:

    Адрес сервера - адрес сервера где опубликована база

    Имя БД - Имя опубликованной базы

    Имя - Имя запроса

    Параметр - Параметр запроса (номер магазина)



#. "number=" - номер магазина



**Описание**

``Запрос с параметром "number="``


:term:`УНФ` По переданному номеру получает ссылку на магазин вызывая функцию:

.. function:: крюОбменСArtixСервер.ПолучитьМагазинПоНомеруНовый(Номер)
    
    В функцию передается номер магазина, возвращается ссылка на магазин либо если магазин не найден - **Неопределено**
    Если магазин не найден, то возвращается код возврата "405", в теле ответа сообщение вида "Отсутствует магазин test22 GetProductRemains"
    и сервис завершает свою работу.
    Если ссылка на магазин получена, вызывается функцмя 


.. function:: ВернутьОстатки(текМагазин,Номер)
    
    В функции определяется тип цен текущего магазина.
    Затем происходит заполнение массива данными по номенклатуре
    Определяется общий список номенклатуры:

.. function:: invent = ВыполнитьЗапросПоНоменклатуре(ВидЦены,текМагазин);

    Далее формируется массив содержащий только ссылки выбранных позиций товара. Эти данные в дальнейшем будут передаваться в
    функции для формирования различных частей данных для выгрузки номенклатуры:


.. csv-table:: **Объекты выгрузки товара**
   :header: "Реквизит", "Тип", "Описание"
   :widths: 15, 10, 30

   "additionalprices", "массив объектов", "Массив дополнительных цен"
   "barcodes", "массив объектов", "Массив дополнительных штрих-кодов"
   "inventitemoptions", "объект", "Опции товара"
   "priceoptions", "объект", "Опции цены"
   "quantityoptions", "объект", "Опции количества"
   "sellrestrictperiods", "массив объектов", "Массив ограничений продаж по времени"
  

    

.. function::  Результат = КассоваяСменаПолучить(текМагазин,Номер,Результат);                           			

    Получает максимальный номер закрытой кассовой смены по текущему магазину. И добавляет в общий массив выгрузки.
    Тело ответа на запрос содержит сформированные данные.



В случае удачного завершения работы сервис возвращает код "200", в противном варианте вернется код ошибки.

-----

*


