%http://texblog.org/2011/09/09/10-ways-to-customize-tocloflot/

%Автоматически вписывать картинки в ширину страницы:
%\includegraphics[maxwidth=\linewidth]{foobar}

\if 0
Так можно сделать многострочный комментарий.
Это маленький хак. Его надо использовать.
\fi

\documentclass[twoside,11pt,a4paper,notitlepage]{report}

\makeatletter
\newcommand*{\toccontents}{\@starttoc{toc}}
%\usepackage{pscyr}

\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\renewcommand{\rmdefault}{CMR}
\usepackage[russian]{babel}

\usepackage[dvipsnames]{xcolor}

\usepackage{listings,newtxtt}
\lstloadlanguages{Python}
\usepackage{listings}      % для кусков программ 
% (понимает синтаксис некоторых языков, чума просто)
\usepackage{alltt}         % для того же
\usepackage{amssymb}       % прикольно для формул

\usepackage{caption} 

\usepackage{tikz}
\usetikzlibrary{calc}
\usetikzlibrary{backgrounds}


%******************** 
\usepackage{amsmath}



\usepackage{titlesec}
\usepackage{csquotes} % ещё одна штука для цитат

\usepackage{sectsty}
\subsectionfont{\Large\underline}

\usepackage{graphicx}
\usepackage{sidecap}
\usepackage{xcolor}
\usepackage{pdfpages}
\usepackage{comment}
\usepackage{textcomp}
\usepackage{wrapfig}
\usepackage{sectsty}
\usepackage{lipsum}
\usepackage{fancyhdr}
\usepackage{datetime}
\chapterfont{\centering}


\usepackage{subcaption}

\usepackage[T2A]{fontenc}
\usepackage{lscape}
\usepackage{makecell}
\usepackage{multicol}
\usepackage{floatrow}
\usepackage{float}
\usepackage{lastpage} % Allows referencing of the last page to allow footer to read: "Page [Current page] of [Total number of pages]."

\usepackage{dirtree}




\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

%\usepackage{caption}
%\DeclareCaptionFont{white}{\color{white}}
%\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}}
%\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}


\DeclareCaptionFont{white}{ \color{white} }
\DeclareCaptionFormat{listing}{
	\colorbox[cmyk]{0.43, 0.35, 0.35,0.01 }{
		\parbox{\textwidth}{\hspace{15pt}#1#2#3}
	}
}
\captionsetup[lstlisting]{ format=listing, labelfont=white, textfont=white, singlelinecheck=false, margin=0pt, font={bf,footnotesize} } 


\lstdefinestyle{BashInputStyle}{
	language=bash,
	basicstyle=\small\sffamily,
	numbers=left,
	numberstyle=\tiny,
	numbersep=3pt,
	frame=tb,
	columns=fullflexible,
	backgroundcolor=\color{yellow!20},
	linewidth=0.9\linewidth,
	xleftmargin=0.1\linewidth
}

\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\normalsize ,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=none,
	frame=/topline
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=4
	%	rulecolor =\color{codegreen}
}

\lstdefinestyle{customc}{
	belowcaptionskip=1\baselineskip,
	breaklines=true,
	frame=L,
	xleftmargin=\parindent,
	language=Python,
	showstringspaces=false,
	basicstyle=\footnotesize\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{blue},
	stringstyle=\color{orange},
}

\lstdefinestyle{customasm}{
	belowcaptionskip=1\baselineskip,
	frame=L,
	xleftmargin=\parindent,
	language=[x86masm]Assembler,
	basicstyle=\footnotesize\ttfamily,
	commentstyle=\itshape\color{purple!40!black},
}


\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codeorange}{rgb}{1,0.49,0}
\definecolor{backcolour}{rgb}{0.95,0.95,0.96}

\lstdefinestyle{mystyleNew}{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegray},
	keywordstyle=\color{codeorange},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codegreen},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2,
	xleftmargin=10pt,
}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
	basicstyle=\normalfont\ttfamily,
	numbers=left,
	numberstyle=\scriptsize,
	stepnumber=1,
	numbersep=8pt,
	showstringspaces=false,
	breaklines=true,
	frame=lines,
	backgroundcolor=\color{background},
	literate=
	*{0}{{{\color{numb}0}}}{1}
	{1}{{{\color{numb}1}}}{1}
	{2}{{{\color{numb}2}}}{1}
	{3}{{{\color{numb}3}}}{1}
	{4}{{{\color{numb}4}}}{1}
	{5}{{{\color{numb}5}}}{1}
	{6}{{{\color{numb}6}}}{1}
	{7}{{{\color{numb}7}}}{1}
	{8}{{{\color{numb}8}}}{1}
	{9}{{{\color{numb}9}}}{1}
	{:}{{{\color{punct}{:}}}}{1}
	{,}{{{\color{punct}{,}}}}{1}
	{\{}{{{\color{delim}{\{}}}}{1}
	{\}}{{{\color{delim}{\}}}}}{1}
	{[}{{{\color{delim}{[}}}}{1}
	{]}{{{\color{delim}{]}}}}{1},
}


\lstdefinelanguage{Ini}
{
	basicstyle=\ttfamily\small,
	columns=fullflexible,
	morecomment=[s][\color{Green}\bfseries]{[}{]},
	morecomment=[l]{\#},
	morecomment=[l]{;},
	commentstyle=\color{gray}\ttfamily,
	morekeywords={},
	otherkeywords={=,:},
	keywordstyle={\color{red}\bfseries}
} 


\lstset{style=mystyle}




\usepackage[normalem]{ulem} % either use this (simple) or
\usepackage{soul} % use this (many fancier options)


% Создание индекса
%\usepackage{makeidx}
%\makeindex

%История изменений
%\usepackage{vhistory}
\usepackage[owncaptions]{vhistory}%[tocentry] включить в оглавление



\usepackage[most]{tcolorbox} % для управления цветом
\definecolor{block-gray}{gray}{0.90} % уровень прозрачности (1 - максимум)
\newtcolorbox{myquote}{colback=block-gray,grow to right by=-10mm,grow to left by=-10mm,
	boxrule=0pt,boxsep=0pt,breakable} % настройки области с изменённым фоном

%*************************
\usepackage{shorttoc}% Краткое оглавление
%*************************

%*************************
\usepackage{tocloft}% Управление оглавлением
%*************************



%Fncychar позволит выбрать несколько различных стилей, красиво оформляющих наименование глав.
%\usepackage[Glenn]{fncychap} % выбираем стиль Glenn

%Пакет titlesec позволяет вносить изменения в стандартный стиль главы, то есть переопределять его.
%\usepackage{titlesec, blindtext, color} % подключаем нужные пакеты
%\definecolor{gray75}{gray}{0.75} % определяем цвет
%\newcommand{\hsp}{\hspace{20pt}} % длина линии в 20pt
%% titleformat определяет стиль
%\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{|}\hsp}{0pt}{\Huge\bfseries}


\pagestyle{plain} % нумерация страниц вкл.

%http://tex.stackexchange.com/questions/181183/combine-usepackagetimes-and-fontspec-setmainfont
%http://andreyolegovich.ru/PC/LaTeX.php#base

%********************
% Набор предоставляет дополнительные математические символы, множество удобных возможностей для оформления математических формул (например, упрощённую работу с многострочными формулами) и используется почти во всех LaTeX-документах, в которых есть сколько-нибудь сложные формулы.

\renewcommand{\familydefault}{\sfdefault} %Изменит стандартный шрифт документа на сансерифный.

\definecolor{MSBlue}{rgb}{.204,.353,.541}
\definecolor{MSLightBlue}{rgb}{.31,.506,.741}
%\titleformat*{\section}{\Large\bfseries\sffamily\color{MSBlue}}
%\titleformat*{\subsection}{\large\bfseries\sffamily\color{MSLightBlue}}
%\titleformat*{\subsubsection}{\itshape\subsubsectionfont}

\newcommand{\shellcmd}[1]{\\\indent\indent\texttt{\footnotesize\# #1}\\}


\lstdefinestyle{DOS}
{
	backgroundcolor=\color{black},
	basicstyle=\scriptsize\color{white}\ttfamily
}



\newcommand*{\Package}[1]{\texttt{#1}}%

\DeclareTotalTCBox{\commandbox}{ s v }
{verbatim,colupper=white,colback=black!75!white,colframe=black}
{\IfBooleanT{#1}%
	\lstinline[language=command.com,keywordstyle=\color{blue!35!white}\bfseries]^#2^}



\titleformat
{\chapter} % command
[display] % shape
{\bfseries\Large\itshape} % format
{Story No. \ \thechapter} % label
{0.5ex} % sep
{
	\rule{\textwidth}{1pt}
	\vspace{1ex}
	\centering
} % before-code
[
\vspace{-0.5ex}%
\rule{\textwidth}{0.3pt}
] % after-code


\titleformat{\section}[wrap]
{\normalfont\bfseries}
{\thesection.}{0.5em}{}

\titlespacing{\section}{12pc}{1.5ex plus .1ex minus .2ex}{1pc}

%*****************************************************
% Часто требуется, чтобы номер рисунка содержал в себе номер главы (вроде Рис. 1.1). Чтобы была сделана нумерация по главам, достаточно изменить счётчик рисунков в преамбуле документа вот так:
\renewcommand{\thefigure}{\thesection.\arabic{figure}}
%*****************************************************

%*****************************************************
%Если вас не устраивает вид подрисуночной подписи (например, вместо "Рис. 1:" необходимо "Рис. 1 --- "), используйте пакет caption. В частности, для установки тире в качестве разделителя, вставьте в преамбулу документа следующий код: 
\RequirePackage{caption}
\DeclareCaptionLabelSeparator{defffis}{ --- }
\captionsetup{justification=centering,labelsep=defffis}
%*****************************************************

%\usepackage[colorlinks=true,linkcolor=blue]{hyperref}

%*****************************************************
%Как сделать, чтобы уравнения нумеровались независимо по главам в LaTeX?
%В преамбуле
\makeatletter \@addtoreset{equation}{section} \makeatother 
\makeatletter \@addtoreset{figure}{section} \makeatother 
%*****************************************************

\addto\captionsrussian{
	\def\figurename{Рисунок}
}


\usepackage[hypcap]{caption}

%*****************************************************
% Начинать секции с новой страницы
\usepackage{titlesec}
\newcommand{\sectionbreak}{\clearpage}
%*****************************************************


%*****************************************************
%Чтобы в генерированном PDF работали гиперссылки, то надо подключить модуль hyperref (и если хотите их разрисовать, то модуль по работе с цветами xcolor):
\usepackage{hyperref}
% Цвета для гиперссылок
\definecolor{linkcolor}{HTML}{012b37} % цвет ссылок
\definecolor{urlcolor}{HTML}{012b37} % цвет гиперссылок
\hypersetup{pdfstartview=FitH,  linkcolor=linkcolor,urlcolor=urlcolor, colorlinks=true}
%*****************************************************

%***************************************************** 
%Для удаления номеров страниц из \listoffigures
\makeatletter
\newcommand{\emptypage}[1]{%
	\cleardoublepage
	\begingroup
	\let\ps@plain\ps@empty
	\pagestyle{empty}
	#1
	\cleardoublepage}
\makeatletter
%*****************************************************


\setcounter{secnumdepth}{3}
%\usepackage{enumitem}
\usepackage[shortlabels]{enumitem}
\setlist[enumerate]{leftmargin=*,align=left,label=\thesubsection.\arabic*.}
%\usepackage{enumerate}
\usepackage{longtable}

%\renewcommand{\rmdefault}{ftm}
\renewcommand{\rmdefault}{cmr}
\renewcommand{\thesection}{\arabic{section}}
%\usepackage{enumitem}
%%% Страница
%\usepackage{extsizes} % Возможность сделать 14-й шрифт
\usepackage{geometry} % Простой способ задавать поля
\geometry{top=15mm}
\geometry{bottom=10mm}
\geometry{left=10mm}
\geometry{right=10mm}

%*****************************************************
%Here is how you can increase the space between the number and the caption in your \listoffigures. Add the following two lines before your \begin{document}:
	\usepackage{tocloft}
	\setlength{\cftfignumwidth}{3em}
	%With the tocloft-package you can control the design of table of contents, figures and tables.
	%*****************************************************
	
	% раскомментировать, чтобы увидеть забавную картинку размещения текста
	%\usepackage{layout}
	% увидеть, что не сработало и раскомментировать \layout внизу
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%
	%%% мелочи жизни (переопределение буллетов для списков)
	%%%
	\renewcommand{\labelitemii}{{$\mathbf{+}$}}
	\renewcommand{\labelitemiii}{{$\mathbf{++}$}}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%
	%%% Моя любимая настройка параметров страницы. По умолчанию колонка узковатая
	%%%
	\voffset=-10mm
	\topmargin=0mm
	\headheight=5mm
	\headsep=10mm
	
	\textheight=237mm
	\footskip=10mm
	
	\oddsidemargin=-2mm
	\evensidemargin=-15mm
	% регулирует расстояние sidenotes от края страницы
	\hoffset=5mm
	\textwidth=175mm
	\marginparsep=10mm
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	
	\usepackage{svn}
	
	
	\pagestyle{fancy}
	%\fancyfoot[]{вер. 1.05}
	
	%\fancyhead[C]{Страница \thepage \; из \pageref{LastPage}}
	%\fancyhead[RE]{\slshape\nouppercase{\rightmark}}
	%\fancyhead[LO]{\slshape\nouppercase{\leftmark}}
	%\fancyfoot[C]{Страница \thepage \; из \pageref{LastPage}}
	%\renewcommand{\headrulewidth}{0pt}
	%\renewcommand{\footrulewidth}{0pt}
	%\lhead{\footnotesize \parbox{11cm}{Draft 1} }
	
	% Allows calling chapter and section names in headers and footers.
	%\renewcommand{\chaptermark}[1]{%
		%	\markboth{\chaptername\ \thechapter}
		%	{\noexpand\firstsubsectiontitle}}
	%\renewcommand{\sectionmark}[1]{}
	%\renewcommand{\subsectionmark}[1]{%
		%	\markright{#1}\gdef\firstsubsectiontitle{#1}}
	%\newcommand\firstsubsectiontitle{}
	
	
	
	\lhead{\footnotesize \parbox{11cm}}
	%\lfoot{\footnotesize \parbox{11cm}{\textit{2}}}
	%\cfoot{}
	\rhead{\footnotesize  \chaptername \ - \rightmark}
	%\rfoot{\footnotesize Page \thepage\ of \pageref{LastPage}}
	%\fancyfoot[C]{Страница \thepage \; из \pageref{LastPage}}
	\fancyfoot{} % Clear all footer fields
	\fancyfoot[RO,L] {v.\vhCurrentVersion \ \vhCurrentDate}  % Версия и дата
	\fancyfoot[RO,R]{Страница \thepage \; из \pageref{LastPage}} % Page number on right in footer
	
	%\renewcommand{\headheight}{24pt}
	\setlength{\headheight}{4pt}
	\renewcommand{\footrulewidth}{0pt}
	%\setlength\headheight{80.0pt}
	%\addtolength{\textheight}{-80.0pt}
	%\chead{\includegraphics[width=\textwidth]{img/log1o.png}}
	%\cfoot{\includegraphics[width=\textwidth]{img/foot.png}}
	
	\graphicspath{{images/}}
	
	
	
	%*****************************************************
	%Номера страниц, включающие номер главы
	\usepackage[auto]{chappg} %%% this is to set the page numbers as Chapter-Page.
	%*****************************************************
	
	
	
	\newdate{date}{28}{01}{2016}
	\date{\displaydate{date}}
	%Increase the value of tocdepth and secnumdepth. The tocdepth value determines to which level the sectioning commands are printed in the ToC (they are always included in the .toc file but ignored otherwise). The secnumdepth value determines up to what level the sectioning titles are numbered. They are LaTeX counters and you can set them using 
	\setcounter{tocdepth}{1}
	\setcounter{secnumdepth}{4}
	
	\renewcommand{\theenumi}{\arabic{enumi}}
	\renewcommand{\labelenumi}{\arabic{enumi}}
	\renewcommand{\theenumii}{.\arabic{enumii}}
	\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}.}
	\renewcommand{\theenumiii}{.\arabic{enumiii}}
	\renewcommand{\labelenumiii}{\arabic{enumi}.\arabic{enumii}.\arabic{enumiii}.}
	
	
	\usepackage{titlepic}
	
	
	
	%\titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}
	%\titlespacing{\subsection}{0pt}{\parskip}{-\parskip}
	
	\def\capfigure{figure}
	
	\def\captable{table}
	
	\long\def\@makecaption#1#2{%
		
		\vskip\abovecaptionskip
		
		\ifx\@captype\capfigure
		
		\centering #1~--~#2 \par
		
		\else
		
		#1~--~#2 \par
		
		\fi
		
		\vskip\belowcaptionskip}
	
	\setlength\abovecaptionskip{2\p@}
	
	\setlength\belowcaptionskip{1\p@}
	
	
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%
	%%% маленький хак, новое окружение 'algorithm' (см. использование ниже)
	%%%
	\newlength{\algboxsp}
	\setlength{\algboxsp}{2mm}
	\newsavebox{\algbox}
	\newenvironment{basealgorithm}
	{\begin{lrbox}{\algbox}\begin{minipage}{\textwidth}\begin{alltt}}
				{\end{alltt}\end{minipage}\end{lrbox}
		\fbox{
			\parbox{0.95\textwidth}{
				\makebox[0mm]{}
				\\[\algboxsp]
				\mbox{\hspace{\algboxsp}}
				\usebox{\algbox}
				\\[\algboxsp] } }}
	
	\newenvironment{algorithm}[1]
	{\begin{figure}[btp]\def\algcptn{\caption{#1}}\begin{basealgorithm}}
			{\end{basealgorithm}\algcptn\end{figure}}
	
	
	
	%**********************************
	% Todo notes - example from http://www.texample.net/tikz/examples/todo-notes/
	\usepackage{verbatim}
	\usepackage[colorinlistoftodos]{todonotes}
	%**********************************
	
	%\usepackage{sidenotes}
	
	
	\usepackage{geometry}
	
	\usepackage{snotez}
	
	
	
	%**********************************************************
	
	% Vertically aligning a marginnote and a section title
	%**********************************************************
	\usepackage{lipsum}
	
	\usepackage{marginnote}
	\reversemarginpar % To put the margin pars on the left
	\renewcommand*{\marginfont}{\normalfont\normalsize}
	
	
	
	\newcommand*{\Date}[4]{%
		\begin{tikzpicture}[show background rectangle,inner frame sep=0pt,text width=1cm,align=center]
			\node [fill=orange] at (0,0)                                (dayofweek)  {#1};
			\node [fill=white ] at ($(dayofweek)  +(0,-\baselineskip)$) (dayofmonth) {#2};
			\node [fill=white ] at ($(dayofmonth) +(0,-\baselineskip)$) (month)      {#3};
			\node [fill=orange] at ($(month)      +(0,-\baselineskip)$) (dayofmonth) {#4};
		\end{tikzpicture}
	}
	
	%**********************************************************
	\usepackage{geometry}
	\usepackage{marginnote}
	
	
	
	\lstset{tabsize=4,
		breaklines,
		columns=fullflexible,
		flexiblecolumns,
		extendedchars=\true
	}
	
	
	\renewcommand{\cftchapfont}{\scshape}
	\renewcommand{\cftsecfont}{\bfseries}
	%\renewcommand{\cftfigfont}{Figure }
	%\renewcommand{\cfttabfont}{Table }
	
	\usepackage{eso-pic}	
	
	
	\AddToShipoutPicture{%
		
		\AtPageLowerLeft{%
			\hspace*{.02\textwidth}%
			\rotatebox{90}{%
				\begin{minipage}{\paperheight}
					\fontsize{6}{6}\selectfont
					%				\centering\textcopyright~\today{} ТД Крюгер
					\textcopyright~ ООО "КРЮГЕР ХАУС"
					%				\textcopyright~ ТД Крюгер тел.техподдержки 8-913 016 0854
				\end{minipage} %
			}
		} %
	}%
	
	%How can I put real notes in the margin?
	%**********************************************************	
	\usepackage{xparse}
	\usepackage{tikz}
	\usetikzlibrary{calc,fit, decorations.pathmorphing}
	
	\makeatletter
	% http://tex.stackexchange.com/questions/39296/simulating-hand-drawn-lines
	\pgfdeclaredecoration{penciline}{initial}{
		\state{initial}[width=+\pgfdecoratedinputsegmentremainingdistance,auto corner on length=1mm,]{
			\pgfpathcurveto%
			{% From
				\pgfqpoint{\pgfdecoratedinputsegmentremainingdistance}
				{\pgfdecorationsegmentamplitude}
			}
			{%  Control 1
				\pgfmathrand
				\pgfpointadd{\pgfqpoint{\pgfdecoratedinputsegmentremainingdistance}{0pt}}
				{\pgfqpoint{-\pgfdecorationsegmentaspect\pgfdecoratedinputsegmentremainingdistance}%
					{\pgfmathresult\pgfdecorationsegmentamplitude}
				}
			}
			{%TO 
				\pgfpointadd{\pgfpointdecoratedinputsegmentlast}{\pgfpoint{1pt}{1pt}}
			}
		}
		\state{final}{}
	}
	\makeatother
	\newcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) {};}
	\newcommand{\CommentText}[3]{\tikzmark{#1}#3\tikzmark{#2}}
	\NewDocumentCommand{\CommentPar}{%
		O{}% #1 = draw options for the referenced word
		O{}% #2 = draw options for the comment
		O{}% #3 = draw options for the connecting line
		m  % #4 = left \tikzmark name
		m  % #5 = left \tikzmark name
		m  % #6 = comment
	}{%
		\begin{tikzpicture}[overlay,remember picture,decoration=penciline, thick]
			\node [shape=rectangle,inner sep=0, draw=blue, ,rounded corners=2pt, fit={(#4.south) ($(#5.north)+(0,0.75ex)$)}, decorate, #1] (Source) {};
			\node at ($(#4)!0.5!(#5)$) [blue, font=\itshape, rounded corners=5pt, decorate, #2] (Label) {#6};
			\draw [draw=red, decorate, #3] (Label) to (Source);
		\end{tikzpicture}
	}
	
	%**********************************************************
	\usepackage[os=win]{menukeys}
	% меняестся стиль, тени у кнопок
	%**********************************************************
	%\changemenucolor{gray}{txt}{named}{red} %Изменение цвета 
	\renewmenumacro{\keys}[>]{shadowedroundedkeys}
	\renewmenumacro{\menu}{roundedmenus} % default: menus
	%\newmenumacro{\button}
	%**********************************************************
	
	
	% белые кнопки вызов \keystroke{Ctrl} 
	\newcommand*\keystroke[1]{%
		\tikz[baseline=(key.base)]
		\node[%
		draw,
		fill=white,
		drop shadow={shadow xshift=0.25ex,shadow yshift=-0.25ex,fill=black,opacity=0.75},
		rectangle,
		rounded corners=2pt,
		inner sep=1pt,
		line width=0.5pt,
		font=\scriptsize\sffamily
		](key) {#1\strut}
		;
	}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% Для рамки "Внимание"
	%\usepackage{fourier}
	
	\usepackage[utf8]{inputenc}
	\usepackage{newunicodechar}
	
	\newcommand\Warning{%
		\makebox[1.4em][c]{%
			\makebox[0pt][c]{\raisebox{.1em}{\small!}}%
			\makebox[0pt][c]{\color{red}\Large$\bigtriangleup$}}}%
	
	\newunicodechar{⚠}{\Warning}
	
	
	
	\usepackage{blindtext}
	\usepackage{pifont,mdframed}
	
	\newenvironment{warning}
	{\par\begin{mdframed}[linewidth=2pt,linecolor=red]%
			\begin{list}{}{\leftmargin=1cm
					\labelwidth=\leftmargin}\item[\Large \Warning]} %				\labelwidth=\leftmargin}\item[\Large\ding{43}]}
	{\end{list}\end{mdframed}\par}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%How to remove headers and footers for pages between chapters?
\makeatletter
\renewcommand*{\cleardoublepage}{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}%
\thispagestyle{empty}%
\newpage%
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% http://tex.stackexchange.com/questions/39017/how-to-influence-the-position-of-float-environments-like-figure-and-table-in-lat
% СЧЕТЧИКИ / COUNTERS
%    totalnumber (default 3) =Макс кол-во флоатс на странице
%                             max number of floats in a page
%    topnumber (default 2) = макс кол-во флоатс вверху страницы
%                            max number of floats in the top area
%    bottomnumber (default 1) = макс кол-во флоатс внизу страницы
%                               max number of floats in the bottom area
% РАЗМЕРЫ (доли страницы) / AREAS (use \renewcommand)
%    \topfraction (default 0.7) макс доля, проходящаяся на верх страницы
%                               maximum size of the top area
%    \bottomfraction (default 0.3)  макс доля приходящаяся на низ
%                                   maximum size of the bottom area
%    \textfraction (default 0.2)  миним доля, которая должна быть занята текстом
%                                 minimum size of the text area, i.e., the area that must not be occupied by floats
%\setlength{\intextsep}{4ex} % remove extra space above and below in-line float
%\setlength{\floatsep }{1ex} % remove extra space above and below in-line float

%% Попробуйте поизменять параметры и понаблюдайте за эффектом
%% Try changing the below parameters to see the effect
%\setcounter{totalnumber}{10}
%\setcounter{topnumber}{10}
%\setcounter{bottomnumber}{10}
%\renewcommand{\topfraction}{1}
%\renewcommand{\bottomfraction}{1}
%\renewcommand{\textfraction}{10}


%\renewcommand{\listingscaption}{Code}
%\renewcommand{\listoflistingscaption}{List of source code examples}

\setlength{\abovecaptionskip}{-1pt}
\setlength{\belowcaptionskip}{-1pt}
%\usepackage[section]{placeins}
%\setlength{\textfloatsep}{5pt plus 1.0pt minus 2.0pt}

%\setcounter{totalnumber}{10}
% \setcounter{topnumber}{10}

%\renewcommand{\topfraction}{1}
% \renewcommand{\textfraction}{0}

%\setlength{\textfloatsep}{10pt plus 1.0pt minus 2.0pt}
%\setlength{\floatsep}{5pt plus 1.0pt minus 1.0pt}
%\setlength{\intextsep}{5pt plus 1.0pt minus 1.0pt}
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}

\pagestyle{plain}
\phantomsection\label{\detokenize{index::doc}}





\chapter{Общее описание}
\label{\detokenize{description:id1}}\label{\detokenize{description::doc}}

Документация по блоку обмена между Artix и УНФ в части выгрузки остатков из УНФ в кассовый сервер Artix и загрузки кассовых смен и продаж в УНФ.








\chapter{Реализация в УНФ}
\label{\detokenize{unf:id1}}\label{\detokenize{unf::doc}}

Функционал работы с Artix со стороны УНФ реализован с помощью:
\begin{enumerate}

\item {} 

Подписки на события для документов товародвижения:
\begin{enumerate}

\item {} 

Поступление товаров

\item {} 

Списание товаров

\item {} 

Оприходование товаров

\item {} 

Перемещение товаров ?

\item {} 

Возврат товаров поставщику

\item {} 
\sphinxAtStartPar
Отчет о розничных продажах ?

\end{enumerate}

\item {} 
\sphinxAtStartPar
Http\sphinxhyphen{}сервисов

\item {} 
\sphinxAtStartPar
Фоновых заданий и обработок

\end{enumerate}

\begin{sphinxadmonition}{note}{Примечание:}
\sphinxAtStartPar
Подумать о перемещении и Отчете о розничных продажах, нужно ли менять остатки на касссых после их проведения
\end{sphinxadmonition}

\begin{sphinxadmonition}{note}{\label{\detokenize{unf:id2}}План:}
\sphinxAtStartPar
Выгрузка
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Внешняя программма}
\label{\detokenize{prox:id1}}\label{\detokenize{prox::doc}}
\sphinxAtStartPar
Посмотрим на исходный код:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{del\PYGZus{}close\PYGZus{}workshift}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,}\PYG{n}{l\PYGZus{}workshift}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{saveworkshift\PYGZus{}del} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{\PYGZus{}all\PYGZus{}db}\PYG{o}{.}\PYG{n}{cursor}\PYG{p}{(}\PYG{p}{)}
        \PYG{k}{for} \PYG{n}{wh} \PYG{o+ow}{in} \PYG{n}{l\PYGZus{}workshift}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{delete \PYGZhy{} }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{wh}\PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{saveworkshift\PYGZus{}del}\PYG{o}{.}\PYG{n}{execute}\PYG{p}{(}\PYG{n}{diff\PYGZus{}data}\PYG{o}{.}\PYG{n}{qrDel\PYGZus{}workshift\PYGZus{}close}\PYG{p}{,}\PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{wh}\PYG{p}{[}\PYG{l+m+mi}{5}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{\PYGZus{}all\PYGZus{}db}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\fvset{hllines={, 1, 2, 3, 5,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{add\PYGZus{}open\PYGZus{}workshift}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,}\PYG{n}{l\PYGZus{}workshift}\PYG{p}{)}\PYG{p}{:}
     \PYG{c+c1}{\PYGZsh{} Добавляем открытые смены в БД}
         \PYG{c+c1}{\PYGZsh{}self.\PYGZus{}mycursor.execute(diff\PYGZus{}data.qrAdd\PYGZus{}workshift\PYGZus{}open, [l\PYGZus{}workshift])}
         \PYG{k}{for} \PYG{n}{wh} \PYG{o+ow}{in} \PYG{n}{l\PYGZus{}workshift}\PYG{p}{:}
             \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{open \PYGZhy{} }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{wh}\PYG{p}{)}\PYG{p}{)}
             \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{\PYGZus{}cursor}\PYG{o}{.}\PYG{n}{execute}\PYG{p}{(}\PYG{n}{diff\PYGZus{}data}\PYG{o}{.}\PYG{n}{qrAdd\PYGZus{}workshift\PYGZus{}open}\PYG{p}{,} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{wh}\PYG{p}{)}\PYG{p}{,}\PYG{p}{]}\PYG{p}{)}
         \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{\PYGZus{}all\PYGZus{}db}\PYG{o}{.}\PYG{n}{commit}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}
\sphinxresetverbatimhllines


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\sphinxcapstartof{table}
\sphinxthecaptionisattop
\sphinxcaption{Простая таблица со сложной шапкой}\label{\detokenize{prox:id2}}
\sphinxaftertopcaption
\begin{tabulary}{\linewidth}[t]{TTT}
\sphinxtoprule
\sphinxstartmulticolumn{2}%
\begin{varwidth}[t]{\sphinxcolwidth{2}{3}}
\sphinxstyletheadfamily \sphinxAtStartPar
Inputs
\par
\vskip-\baselineskip\vbox{\hbox{\strut}}\end{varwidth}%
\sphinxstopmulticolumn
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Output
\\
\sphinxhline\sphinxstyletheadfamily 
\sphinxAtStartPar
A
&\sphinxstyletheadfamily 
\sphinxAtStartPar
B
&\sphinxstyletheadfamily 
\sphinxAtStartPar
A or B
\\
\sphinxmidrule
\sphinxtableatstartofbodyhook
\sphinxAtStartPar
False
&
\sphinxAtStartPar
False
&
\sphinxAtStartPar
False
\\
\sphinxhline
\sphinxAtStartPar
True
&
\sphinxAtStartPar
False
&
\sphinxAtStartPar
True
\\
\sphinxhline
\sphinxAtStartPar
False
&
\sphinxAtStartPar
True
&
\sphinxAtStartPar
True
\\
\sphinxhline
\sphinxAtStartPar
True
&
\sphinxAtStartPar
True
&
\sphinxAtStartPar
True
\\
\sphinxbottomrule
\end{tabulary}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\sphinxcapstartof{table}
\sphinxthecaptionisattop
\sphinxcaption{CSV\sphinxhyphen{}таблица}\label{\detokenize{prox:id3}}
\sphinxaftertopcaption
\begin{tabular}[t]{\X{15}{55}\X{10}{55}\X{30}{55}}
\sphinxtoprule
\sphinxstyletheadfamily 
\sphinxAtStartPar
Treat
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Quantity
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Description
\\
\sphinxmidrule
\sphinxtableatstartofbodyhook
\sphinxAtStartPar
Albatross
&
\sphinxAtStartPar
2.99
&
\sphinxAtStartPar
On a stick!
\\
\sphinxhline
\sphinxAtStartPar
Crunchy Frog
&
\sphinxAtStartPar
1.49
&
\sphinxAtStartPar
If we took the bones out, it wouldn’t be
crunchy, now would it?
\\
\sphinxhline
\sphinxAtStartPar
Gannet Ripple
&
\sphinxAtStartPar
1.99
&
\sphinxAtStartPar
On a stick!
\\
\sphinxbottomrule
\end{tabular}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{Боковая врезка}

\sphinxAtStartPar
Оформление врезки зависит от используемой HTML\sphinxhyphen{}темы.
\end{sphinxShadowBox}
\index{базовая функция@\spxentry{базовая функция}!pyfunc()@\spxentry{pyfunc()}}\index{pyfunc()@\spxentry{pyfunc()}!базовая функция@\spxentry{базовая функция}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{prox:pyfunc}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{pyfunc}}}{}{}
\pysigstopsignatures
\sphinxAtStartPar
Описание функции Python.

\end{fulllineitems}


\begin{sphinxadmonition}{attention}{Внимание:}\begin{quote}

\sphinxAtStartPar
Блок Внимание, команда:
\end{quote}
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Настройки}
\label{\detokenize{setting:id1}}\label{\detokenize{setting::doc}}
\sphinxstepscope


\section{Порядок внедрения касс в работу с Артикс:}
\label{\detokenize{kass:id1}}\label{\detokenize{kass::doc}}

\subsection{1. Создать магазин + касса на сервере.}
\label{\detokenize{kass:id2}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Создание Магазина \sphinxhyphen{} Вводить Код, Название, Формат справочников (из 1С), метка дисконта (выбор из созданных)

\item {} \begin{description}
\sphinxlineitem{Создание Кассы \sphinxhyphen{} Вводить Код, Название, Хост (IP), Тип кассы (Рабочее место кассира), Формат выгрузки продаж (с КС в 1С), Категория справочников (если используется), Состояние обмена (рекоменд. Выключен).         При использовании Конфигураций \sphinxhyphen{} Выбрать конфигурацию, и окружение (для рабочей кассы \sphinxhyphen{} Боевое)}\begin{itemize}
\item {} 
\sphinxAtStartPar
Создать структуру Магазин\sphinxhyphen{}Кассы можно/нужно заранее.

\end{itemize}

\end{description}

\end{enumerate}


\subsection{2. Настройка ПОС}
\label{\detokenize{kass:id3}}
\sphinxAtStartPar
Полуручной:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Самый простой способ предварительно настроить 1 пос, и сохранить нужные файлы настроек (настройки, оборудование и т.д.). Далее скопировать на другую ПОС в требуемые директории.

\end{enumerate}

\sphinxAtStartPar
Автоматически:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Использовать менеджер\sphinxhyphen{}конфигураций (что есть в КС), одна тонкость \sphinxhyphen{} возможно не все настройки можно произвести через него.

\item {} 
\sphinxAtStartPar
Включить обмен на сервере и запустить полную выгрузку справочников с сервера. После полной прогрузки справочников \sphinxhyphen{} перезапустить кассовую программу на ПОС

\end{enumerate}

\sphinxstepscope


\section{Добавление группы сертификатов со сроком действия через REST API.}
\label{\detokenize{sert:rest-api}}\label{\detokenize{sert::doc}}
\sphinxAtStartPar
\sphinxstylestrong{1. Добавление группы сертификатов со сроком действия через REST API.}
\begin{enumerate}
\sphinxsetlistlabels{\alph}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Добавить группу сертификатов в БД КС, сформировав запрос типа POST на url: \sphinxurl{http:/}/\textless{}host\textgreater{}:\textless{}port\textgreater{}/Csrest/rest/dictionaries/certificates

\item {} 
\sphinxAtStartPar
Тело запроса в формате Json должно быть подобного формата:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}code\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}1\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}rangefrom\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{30}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}rangeto\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{40}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}Сертификаты\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}sum\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{300}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}inputmask\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{31}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}discountcampaign\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}test campaign\PYGZdq{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Атрибут свойства  discountcampaign должен содержать yaml акции, в которой как раз можно указать сроки действия.
Напрример, если смотреть на уже существующую группу сертификатов, созданную вручную через web\sphinxhyphen{}интерфейс LM с указанием срока действия (БД КС ArtixAll, таблица certificateTemp), то в поле discountcampaign увидим запись вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{!!python/object:artixds.domain.DiscountCampaign}
\PYG{n+nt}{active}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{true}
\PYG{n+nt}{beginBonusesDateCalculate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{beginBonusesIntervalCondition}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{date}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginBonusesIntervalMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginBonusesIntervalValue}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{0}
\PYG{n+nt}{beginDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{beginDateWithBeginCurrentMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginDateWithBeginNextMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginRangeDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{2022\PYGZhy{}02\PYGZhy{}17}
\PYG{n+nt}{beginTime}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{checkedTags}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{daysOfWeek}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{p+pIndicator}{]}
\PYG{n+nt}{discounts}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{p+pIndicator}{]}
\PYG{n+nt}{endBonusesDateCalculate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{endBonusesIntervalCondition}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{date}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{endBonusesIntervalMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{endBonusesIntervalValue}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{0}
\PYG{n+nt}{endDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{endRangeDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{2022\PYGZhy{}02\PYGZhy{}17}
\PYG{n+nt}{endTime}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{57026161735168}
\PYG{n+nt}{interactionType}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{all}
\PYG{n+nt}{labels}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{manualActivate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{parent}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{parentGroup}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{priority}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{qualifiers}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!set}\PYG{+w}{ }\PYG{p+pIndicator}{\PYGZob{}}\PYG{p+pIndicator}{\PYGZcb{}}
\PYG{n+nt}{tagsIsAllowed}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{n+nt}{weight}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{300}
\end{sphinxVerbatim}

\sphinxAtStartPar
То есть в этом случае срок действия для группы сертификатов определен свойствами beginRangeDate и endRangeDate (от 2022\sphinxhyphen{}02\sphinxhyphen{}17 до 2022\sphinxhyphen{}02\sphinxhyphen{}17).

\sphinxAtStartPar
Берем этот Yaml как шаблон и изменияем даты beginRangeDate и endRangeDate на нужные.
\end{quote}

\item {} 
\sphinxAtStartPar
Далее  этот Yaml необходимо переделать в однострочный формат. Для этого после каждой строки добавляем rn, и переносим все строки в одну. В итоге должна получиться строка следующего вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
!python/object:artixds.domain.DiscountCampaign\PYGZbs{}r\PYGZbs{}nactive: true\PYGZbs{}r\PYGZbs{}nbeginBonusesDateCalculate: null\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalCondition: !!python/unicode \PYGZsq{}date\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalValue: 0\PYGZbs{}r\PYGZbs{}nbeginDate: null\PYGZbs{}r\PYGZbs{}nbeginDateWithBeginCurrentMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginDateWithBeginNextMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginRangeDate: 2022\PYGZhy{}02\PYGZhy{}17\PYGZbs{}r\PYGZbs{}nbeginTime: null\PYGZbs{}r\PYGZbs{}ncheckedTags: null\PYGZbs{}r\PYGZbs{}ndaysOfWeek: []\PYGZbs{}r\PYGZbs{}ndiscounts: []\PYGZbs{}r\PYGZbs{}nendBonusesDateCalculate: null\PYGZbs{}r\PYGZbs{}nendBonusesIntervalCondition: !!python/unicode \PYGZsq{}date\PYGZsq{}\PYGZbs{}r\PYGZbs{}nendBonusesIntervalMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nendBonusesIntervalValue: 0\PYGZbs{}r\PYGZbs{}nendDate: null\PYGZbs{}r\PYGZbs{}nendRangeDate: 2022\PYGZhy{}02\PYGZhy{}17\PYGZbs{}r\PYGZbs{}nendTime: null\PYGZbs{}r\PYGZbs{}nid: 62331387691573\PYGZbs{}r\PYGZbs{}ninteractionType: all\PYGZbs{}r\PYGZbs{}nlabels: null\PYGZbs{}r\PYGZbs{}nmanualActivate: null\PYGZbs{}r\PYGZbs{}nname: !!python/unicode \PYGZsq{}\PYGZsq{}\PYGZbs{}r\PYGZbs{}nparent: null\PYGZbs{}r\PYGZbs{}nparentGroup: null\PYGZbs{}r\PYGZbs{}npriority: null\PYGZbs{}r\PYGZbs{}nqualifiers: !!set \PYGZob{}\PYGZcb{}\PYGZbs{}r\PYGZbs{}ntagsIsAllowed: false\PYGZbs{}r\PYGZbs{}nweight: 300
\end{sphinxVerbatim}

\sphinxAtStartPar
И в таком виде эту строку можно добавить в тело POST\sphinxhyphen{}запроса (пункт 1.1) вместо записи  test campaign.
\end{quote}

\end{enumerate}

\sphinxAtStartPar
\sphinxstylestrong{2. Отправляем POST\sphinxhyphen{}запрос, указав данные для авторизации (как от  WEB  КЦ)}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{1}.png}
\end{figure}
\end{quote}

\sphinxAtStartPar
Далее убеждаемся что запрос прошел без ошибок и проверяем в web\sphinxhyphen{}интерфейсе LM, что создалась группа сертификатов. Открываем эту группу на редактирование и убеждаемся, что сроки действия прописаны корректно.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{2}.png}
\end{figure}
\end{quote}

\sphinxAtStartPar
\sphinxstylestrong{3. Затем добавляем сертификат на сервер POST\sphinxhyphen{}запросом http://\textless{}хост\textgreater{}:\textless{}порт бонусного сервера/сервера сертификатов\textgreater{}/ACC/rest/v1/cards.}
\begin{quote}

\sphinxAtStartPar
Тело запроса должно быть вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}number\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}30\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}accountNumber\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}30\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}status\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}EARN\PYGZus{}PAY\PYGZdq{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}
\end{quote}
\end{quote}

\sphinxAtStartPar
Важно, чтобы значения  number и  accountNumber входили в диапозон номеров созданной группы сертификатов.

\sphinxstepscope


\section{Дополнительные материалы:}
\label{\detokenize{additional:id1}}\label{\detokenize{additional::doc}}

\subsection{1. Список директорий и файлов  основных настроек.}
\label{\detokenize{additional:id2}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} \begin{description}
\sphinxlineitem{/linuxcash/cash/conf/}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumii}{enumiii}{}{)}%
\item {} 
\sphinxAtStartPar
ncash.ini \sphinxhyphen{} основной файл настроек

\item {} 
\sphinxAtStartPar
bcode.ini  \sphinxhyphen{} правила разбора ШК

\item {} 
\sphinxAtStartPar
frinit.conf \sphinxhyphen{} инициализация ФР

\item {} 
\sphinxAtStartPar
cliche.txt и tail.txt \sphinxhyphen{} Клише/подвал чека

\item {} 
\sphinxAtStartPar
artixsb.conf

\end{enumerate}

\end{description}

\item {} \begin{description}
\sphinxlineitem{/linuxcash/cash/conf/ncash.ini.d/}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumii}{enumiii}{}{)}%
\item {} 
\sphinxAtStartPar
artixbonus.ini \sphinxhyphen{} работа с бонусным сервером

\item {} 
\sphinxAtStartPar
artixcertificate.ini

\item {} 
\sphinxAtStartPar
deferredcheck.ini \sphinxhyphen{} отложенные чеки

\item {} 
\sphinxAtStartPar
fr.ini

\item {} 
\sphinxAtStartPar
gui.ini \sphinxhyphen{} выбор интерфейса ПО

\item {} 
\sphinxAtStartPar
motp.ini \sphinxhyphen{} сигареты

\item {} 
\sphinxAtStartPar
markedgoods.ini \sphinxhyphen{} другая маркировка

\end{enumerate}

\end{description}

\item {} 
\sphinxAtStartPar
/linuxcash/cash/conf/drivers/ \sphinxhyphen{} Настройки подключения оборудования

\end{enumerate}

\sphinxAtStartPar
Сначала настраивается одна ПОС, полученные настройки используем как эталонные. После установки ПО на новую ПОС копируем настройки,
включая “Подключаемое оборудование”, проверяем и при необходимости вносим правки.


\subsection{2. Особенности настройки “Сбербанк”}
\label{\detokenize{additional:id3}}
\sphinxAtStartPar
Для работы с процессингом сбербанк необходимо установить пакет \sphinxhyphen{} \sphinxstyleemphasis{artix45\sphinxhyphen{}plugin\sphinxhyphen{}sb}.
В директорию \sphinxstylestrong{”/linuxcash/cash/paysystems/sb/“} разместить файлы приложения сбербанк полученного от сотрудников банка. Настроить подключение ПинПад согласно инструкции банка (pinpad.ini). Следует обратить внимание что при подключении пинпад через USB, необходимо правильно создать символьную ссылку на устройство:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ln} \PYG{o}{\PYGZhy{}}\PYG{n}{s} \PYG{o}{/}\PYG{n}{dev}\PYG{o}{/}\PYG{n}{serial}\PYG{o}{/}\PYG{n}{by}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{id}\PYG{o}{/}\PYG{p}{\PYGZob{}}\PYG{n}{Имя\PYGZus{}Устройства}\PYG{p}{\PYGZcb{}} \PYG{o}{/}\PYG{n}{linuxcash}\PYG{o}{/}\PYG{n}{cash}\PYG{o}{/}\PYG{n}{paysystems}\PYG{o}{/}\PYG{n}{sb}\PYG{o}{/}\PYG{n}{ttyS99}
\end{sphinxVerbatim}

\sphinxAtStartPar
Для работы с терминалом PAX SP30 \sphinxhyphen{} дополнительно установить пакет \sphinxstyleemphasis{ttypos}


\subsection{3. Ссылка на скачивание дистрибутива yuki}
\label{\detokenize{additional:yuki}}\begin{quote}

\sphinxAtStartPar
\sphinxurl{http://update.artix.su/static/yuki/}
\end{quote}


\subsection{4. Остатки}
\label{\detokenize{additional:id4}}
\sphinxAtStartPar
в конфигурационном файле /linuxcash/cash/conf/ncash.ini
Изменить:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{;}\PYG{n}{calculateRemainsOfGoods} \PYG{o}{=} \PYG{n}{false}
\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{p}{;}\PYG{n}{considerRemainsOfGoods} \PYG{o}{=} \PYG{n}{false}
\end{sphinxVerbatim}

\sphinxAtStartPar
на:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{calculateRemainsOfGoods} \PYG{o}{=} \PYG{n}{true}
\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{n}{considerRemainsOfGoods} \PYG{o}{=} \PYG{n}{true}
\end{sphinxVerbatim}

\sphinxAtStartPar
После изменения настроек надо перезапустить кассовое По.
Тогда касса будет считать остатки и учитывать их при продажи


\subsection{5. Дисконтные карты (создание)}
\label{\detokenize{additional:id5}}\begin{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
создать счет на бонусном сервере

\item {} 
\sphinxAtStartPar
привязать номер карты к счету

\item {} 
\sphinxAtStartPar
создать карту на кассовом сервере (группа должна быть создана заранее)

\end{enumerate}

\sphinxAtStartPar
1 и 2 это работа с апи бонусного сервера

\sphinxAtStartPar
3 это работа с файлом аиф, или через рестапи загрузки справочников с Кассовым севером.

\sphinxAtStartPar
\sphinxurl{https://docs.artix.su/pages/viewpage.action?pageId=27530936}
\end{quote}


\chapter{Индексы и таблицы}
\label{\detokenize{index:id1}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}

\sphinxAtStartPar
Что реализовать:

\begin{sphinxadmonition}{note}{План:}
\sphinxAtStartPar
Fix this
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{description:id2}]{\sphinxcrossref{\sphinxstyleemphasis{исходный элемент}}}} находится в /home/bat/Project/docs/Artix\_Global/source/description.rst, строка 8.)

\begin{sphinxadmonition}{note}{План:}
\sphinxAtStartPar
Выгрузка
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{unf:id2}]{\sphinxcrossref{\sphinxstyleemphasis{исходный элемент}}}} находится в /home/bat/Project/docs/Artix\_Global/source/unf.rst, строка 23.)



\renewcommand{\indexname}{Алфавитный указатель}
\printindex
\end{document}