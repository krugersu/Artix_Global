%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[a4paper,10pt,russian]{report}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}


\usepackage{amsmath,amsfonts,amssymb,amsthm}


\usepackage{fncychap}
\usepackage{sphinx}
\sphinxsetup{hmargin={0.7in,0.7in}, vmargin={1in,1in},         verbatimwithframe=true,         TitleColor={rgb}{0,0,0},         HeaderFamily=\rmfamily\bfseries,         InnerLinkColor={rgb}{0,0,1},         OuterLinkColor={rgb}{0,0,1}}
\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsrussian{\renewcommand{\contentsname}{Описание:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{0}


        %%%%%%%%%%%%%%%%%%%% Meher %%%%%%%%%%%%%%%%%%
        %%%add number to subsubsection 2=subsection, 3=subsubsection
        %%% below subsubsection is not good idea.
        \setcounter{secnumdepth}{3}
        %
        %%%% Table of content upto 2=subsection, 3=subsubsection
        \setcounter{tocdepth}{2}

        \usepackage{amsmath,amsfonts,amssymb,amsthm}
        \usepackage{graphicx}

        %%% reduce spaces for Table of contents, figures and tables
        %%% it is used "\addtocontents{toc}{\vskip -1.2cm}" etc. in the document
        \usepackage[notlot,nottoc,notlof]{}

        \usepackage{color}
        \usepackage{transparent}
        \usepackage{eso-pic}
        \usepackage{lipsum}

        \usepackage{footnotebackref} %%link at the footnote to go to the place of footnote in the text

        %% spacing between line
        \usepackage{setspace}
        %%%%\onehalfspacing
        %%%%\doublespacing
        \singlespacing


        %%%%%%%%%%% datetime
        \usepackage{datetime}

        \newdateformat{MonthYearFormat}{%
            \monthname[\THEMONTH], \THEYEAR}


        %% RO, LE will not work for 'oneside' layout.
        %% Change oneside to twoside in document class
        \usepackage{fancyhdr}
        \pagestyle{fancy}
        \fancyhf{}

        %%% Alternating Header for oneside
        \fancyhead[L]{\ifthenelse{\isodd{\value{page}}}{ \small \nouppercase{\leftmark} }{}}
        \fancyhead[R]{\ifthenelse{\isodd{\value{page}}}{}{ \small \nouppercase{\rightmark} }}

        %%% Alternating Header for two side
        %\fancyhead[RO]{\small \nouppercase{\rightmark}}
        %\fancyhead[LE]{\small \nouppercase{\leftmark}}

        %% for oneside: change footer at right side. If you want to use Left and right then use same as header defined above.
        \fancyfoot[R]{\ifthenelse{\isodd{\value{page}}}{{\tiny Meher Krishna Patel} }{\href{http://pythondsp.readthedocs.io/en/latest/pythondsp/toc.html}{\tiny PythonDSP}}}

        %%% Alternating Footer for two side
        %\fancyfoot[RO, RE]{\scriptsize Meher Krishna Patel (mekrip@gmail.com)}

        %%% page number
        \fancyfoot[CO, CE]{\thepage}

        \renewcommand{\headrulewidth}{0.5pt}
        \renewcommand{\footrulewidth}{0.5pt}

        \RequirePackage{tocbibind} %%% comment this to remove page number for following
        \addto\captionsenglish{\renewcommand{\contentsname}{Table of contents}}
        \addto\captionsenglish{\renewcommand{\listfigurename}{List of figures}}
        \addto\captionsenglish{\renewcommand{\listtablename}{List of tables}}
        % \addto\captionsenglish{\renewcommand{\chaptername}{Chapter}}


        %%reduce spacing for itemize
        \usepackage{enumitem}
        \setlist{nosep}

        %%%%%%%%%%% Quote Styles at the top of chapter
        \usepackage{epigraph}
        \setlength{\epigraphwidth}{0.8\columnwidth}
        \newcommand{\chapterquote}[2]{\epigraphhead[60]{\epigraph{\textit{#1}}{\textbf {\textit{--#2}}}}}
        %%%%%%%%%%% Quote for all places except Chapter
        \newcommand{\sectionquote}[2]{{\quote{\textit{``#1''}}{\textbf {\textit{--#2}}}}}
    

\title{Sphinx format for Latex and HTML}
\date{мая 24, 2023}
\release{1.05}
\author{Meher Krishna Patel}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{ }
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}

        \pagenumbering{Roman} %%% to avoid page 1 conflict with actual page 1

        \begin{titlepage}
            \centering

            \vspace*{40mm} %%% * is used to give space from top
            \textbf{\Huge {Sphinx format for Latex and HTML}}

            \vspace{0mm}
            \begin{figure}[!h]
                \centering
                \includegraphics[scale=0.3]{logo.jpg}
            \end{figure}

            \vspace{0mm}
            \Large \textbf{{Meher Krishna Patel}}

            \small Created on : Octorber, 2017

            \vspace*{0mm}
            \small  Last updated : \MonthYearFormat\today


            %% \vfill adds at the bottom
            \vfill
            \small \textit{More documents are freely available at }{\href{http://pythondsp.readthedocs.io/en/latest/pythondsp/toc.html}{PythonDSP}}
        \end{titlepage}

        \clearpage
        \pagenumbering{roman}
        \tableofcontents
        \listoffigures
        \listoftables
        \clearpage
        \pagenumbering{arabic}

        
\pagestyle{plain}
 
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{Общее описание}
\label{\detokenize{description:id1}}\label{\detokenize{description::doc}}

\section{Документация по блоку обмена между Artix и УНФ в части выгрузки остатков из УНФ в кассовый сервер Artix и загрузки кассовых смен и продаж в УНФ.}
\label{\detokenize{description:artix-artix}}
\sphinxAtStartPar
Связь между 1С и Artix осуществляется с помощью Http\sphinxhyphen{}сервисов реализованных на стороне \DUrole{xref,std,std-term}{УНФ}. Данные по продажам 1С забирает из базы данных
Кассового сервера с помощью Sql запросов. Таблицы из БД Кассового сервера подключены в УНФ в качестве внешнего источника данных.
Прокси сервер реализован на Python и располагается на отдельном сервере с Linux.

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{gl}.png}
\end{figure}

\sphinxAtStartPar
Работа происходит следующим образом:
В \DUrole{xref,std,std-term}{УНФ} в справочнике «крю\_Настройки» в предопределенном реквизите «КаталогКонтроляОбменаArtix» хранится путь до каталога интеграции
с Artix, который имеет следующую структуру \sphinxhyphen{}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{cat}.png}
\end{figure}

\sphinxAtStartPar
При проведении документа товародвижения срабатывает расширение «крюВыгрузкаАртикс», которое проверяет интерактивоное проведение документа или нет и в случае
интерактивного проведения в каталоге соответствующем номеру магазина создается файл\sphinxhyphen{}флаг
вида:  «1681466893\_chg», где число это псевдослучайное число образованное разностью дат, для достижения уникальности имени файла.

\sphinxAtStartPar
Номенклатура относящаяся к кулинарии (категория номенклатуры «Кулинария»), выгружается с \sphinxstylestrong{пустым} полем остатка, так как всегда продается в минус. Устанавливать
поле остатка в «0» нельзя, так Artix считает это за остаток равный «0» и соответственно не дает продавать.

\begin{sphinxadmonition}{important}{Важно:}
\sphinxAtStartPar
У номенклатуры для выгрузки в Artix должна быть установлена цена, остаток больше нуля или пустой (для кулинарии), штрихкод с установленной единицой измерения,
единица измерения упаковки. При отсутствии какого\sphinxhyphen{}то из перечисленных свойств, позиция номенклатуры не выгрузится в Artix
\end{sphinxadmonition}

\sphinxAtStartPar
Программа \DUrole{xref,std,std-term}{Brocker} запускаясь с указанной настройкой сервера периодичностью начинает обрабатывать кассовые смены.
Вначале в \DUrole{xref,std,std-term}{УНФ} передаются данные по вновь открытым сменам в Artix. \DUrole{xref,std,std-term}{УНФ} получая информацию создает новые документы «Кассовая смена» со статусом
«Открытая» и автоматом создается документ «ОРП» у которого заполнена только шапка и имеется ссылка на кассовую смену.
После этого \DUrole{xref,std,std-term}{Brocker} отправляет информацию по закрытым кассовым сменам. УНФ заполняет оставшиеся реквизиты в документе «Кассовая смены» и присваевает
документу статус «Закрыта (чеки за архивированы)».
Далее согласно созданному в УНФ расписанию запускается обработка по формированию «ОРП». Данные для заполнения табличных частей «ОРП» берутся запросом из
кассового сервера, таблицы которого подключены в 1С в качестве внешнего источника данных.

\sphinxAtStartPar
Далeе программа прокси  отправляет запрос («GetChangeShop») в УНФ для получения номеров магазинов по которым были изменения остатков в ту
или иную сторону. \DUrole{xref,std,std-term}{УНФ} «просматривает» каталоги в папке интеграции и возвращает список номеров магазинов в каталогах которых, были обнаружены
файлы флаги.
Затем программа \DUrole{xref,std,std-term}{Brocker} перебирая номера магазинов формирует в УНФ запрос остатков по каждому. Получив остатки, \DUrole{xref,std,std-term}{Brocker} обрабатывает данные \sphinxhyphen{}
для номенклатуры с аналогами переносит суммируя все остатки на головную номенклатуру, а аналоги удаляет из выгрузки, таким образом на кассы падает в остатках, только
головная номенклатура.
После формирования остатков, на основе этих данных формируется файл формата \DUrole{xref,std,std-term}{aif} и выгружается в соответствующим каталог магазина.
Кассовый сервер через определенное время «забирает» файл и формирует номенклатуру с остатками на магазине.

\begin{sphinxadmonition}{note}{\label{\detokenize{description:id2}}План:}
\sphinxAtStartPar
Планируется добавить модуль контроля товаро\sphinxhyphen{}остатков пришедших из \DUrole{xref,std,std-term}{УНФ} и выгруженных в кассовый сервер
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Реализация в УНФ}
\label{\detokenize{unf:id1}}\label{\detokenize{unf::doc}}
\sphinxAtStartPar
Функционал работы с Artix со стороны УНФ реализован с помощью:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Расширения \sphinxstylestrong{«крюВыгрузкаАртикс»}. Расширение учитывает следующие виды документов
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumii}{enumiii}{}{)}%
\item {} 
\sphinxAtStartPar
Поступление товаров

\item {} 
\sphinxAtStartPar
Списание товаров

\item {} 
\sphinxAtStartPar
Оприходование товаров

\item {} 
\sphinxAtStartPar
Перемещение товаров

\item {} 
\sphinxAtStartPar
Возврат товаров поставщику

\item {} 
\sphinxAtStartPar
Отчет о розничных продажах

\end{enumerate}

\end{enumerate}

\sphinxAtStartPar
В расширении для формы документа реализована процедура «ПослеЗаписиНаСервере»  с аннотацией \sphinxstylestrong{«\&После»},
что позволяет выполниться коду из расширения, после выполнения основного кода данной процедуры формы.
Реализовано для того, что бы изменения остатков фиксировались только при интерактивном проведении документа и
не и не отрабатывались при проведении программном.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{крюОбменСArtixСервер}\PYG{o}{.}\PYG{n}{БылоИзменениеУчетногоКоличества}\PYG{p}{(}\PYG{n}{ТекущийОбъект}\PYG{p}{,} \PYG{n}{ПараметрыЗаписи}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxAtStartPar
Вызывается процедура \sphinxstylestrong{«БылоИзменениеУчетногоКоличества»} общего модуля \sphinxstylestrong{«крюОбменСArtixСервер»}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Процедура} \PYG{n}{БылоИзменениеУчетногоКоличества}\PYG{p}{(}\PYG{n}{ТекущийОбъект}\PYG{p}{,} \PYG{n}{ПараметрыЗаписи}\PYG{p}{)} \PYG{n}{Экспорт}
   \PYG{n}{Если} \PYG{n}{ПараметрыЗаписи}\PYG{o}{.}\PYG{n}{РежимЗаписи} \PYG{o}{=} \PYG{n}{РежимЗаписиДокумента}\PYG{o}{.}\PYG{n}{Проведение} \PYG{n}{ИЛИ} \PYG{n}{ПараметрыЗаписи}\PYG{o}{.}\PYG{n}{РежимЗаписи} \PYG{o}{=} \PYG{n}{РежимЗаписиДокумента}\PYG{o}{.}\PYG{n}{ОтменаПроведения} \PYG{n}{Тогда}
           \PYG{n}{Если} \PYG{n}{ТекущийОбъект}\PYG{o}{.}\PYG{n}{Ссылка}\PYG{o}{.}\PYG{n}{Метаданные}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{Имя} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ПеремещениеЗапасов}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{Тогда}
                   \PYG{n}{ЗаписатьФлагИзменений}\PYG{p}{(}\PYG{n}{ТекущийОбъект}\PYG{o}{.}\PYG{n}{СтруктурнаяЕдиница}\PYG{p}{)}\PYG{p}{;}
                   \PYG{n}{ЗаписатьФлагИзменений}\PYG{p}{(}\PYG{n}{ТекущийОбъект}\PYG{o}{.}\PYG{n}{СтруктурнаяЕдиницаПолучатель}\PYG{p}{)}\PYG{p}{;}
                \PYG{n}{Иначе}
                        \PYG{n}{ЗаписатьФлагИзменений}\PYG{p}{(}\PYG{n}{ТекущийОбъект}\PYG{o}{.}\PYG{n}{СтруктурнаяЕдиница}\PYG{p}{)}\PYG{p}{;}
                \PYG{n}{КонецЕсли}\PYG{p}{;}
        \PYG{n}{КонецЕсли}\PYG{p}{;}
\PYG{n}{КонецПроцедуры}
\end{sphinxVerbatim}

\sphinxAtStartPar
Процедура проверяет режим записи документа и тип и вызывает функцию \sphinxstylestrong{«ЗаписатьФлагИзменений»}, для
записи файла флага в каталог с имя которого совпадает с номером магазина переданного документа.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Функция} \PYG{n}{ЗаписатьФлагИзменений}\PYG{p}{(}\PYG{n}{Магазин}\PYG{p}{)} \PYG{n}{Экспорт}
   \PYG{n}{НомерМагазина} \PYG{o}{=} \PYG{n}{ПолучитьНомерМагазина}\PYG{p}{(}\PYG{n}{Магазин}\PYG{p}{)}\PYG{p}{;}
   \PYG{n}{ПутьКФайлам}     \PYG{o}{=} \PYG{n}{Справочники}\PYG{o}{.}\PYG{n}{крю\PYGZus{}Настройки}\PYG{o}{.}\PYG{n}{ВернутьЗначениеНастройки}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{КаталогКонтроляОбменаArtix}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
   \PYG{n}{ПрефиксФайла} \PYG{o}{=} \PYG{n}{Формат}\PYG{p}{(}\PYG{n}{ТекущаяДата}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{дата}\PYG{p}{(}\PYG{l+m+mi}{1970}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ЧГ=0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{;}
   \PYG{n}{ИмяФайлаВыгрузки} \PYG{o}{=}\PYG{n}{ПутьКФайлам}\PYG{o}{+} \PYG{n}{НомерМагазина} \PYG{o}{+}  \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+se}{\PYGZbs{}\PYGZdq{}}\PYG{l+s+s2}{ + ПрефиксФайла + }\PYG{l+s+s2}{\PYGZdq{}}\PYG{n}{\PYGZus{}chg}\PYG{o}{.}\PYG{n}{flg}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{;}
   \PYG{n}{ТекстовыйФайл} \PYG{o}{=} \PYG{n}{Новый} \PYG{n}{ТекстовыйДокумент}\PYG{p}{;}
   \PYG{n}{ТекстовыйФайл}\PYG{o}{.}\PYG{n}{Записать}\PYG{p}{(}
           \PYG{n}{ИмяФайлаВыгрузки} \PYG{o}{/}\PYG{o}{/} \PYG{n}{путь} \PYG{n}{для} \PYG{n}{сохранения}
   \PYG{p}{)}\PYG{p}{;}
   \PYG{n}{Возврат} \PYG{n}{Неопределено}\PYG{p}{;}
\PYG{n}{КонецФункции}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{1}
\item {} 
\sphinxAtStartPar
Http\sphinxhyphen{}сервисы:
\begin{quote}

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{Http\sphinxhyphen{}сервис Workshift}

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{GetChangeShop}

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{GetProductRemains}
\end{quote}

\item {} 
\sphinxAtStartPar
Фоновых заданий и обработок
\begin{quote}

\sphinxAtStartPar
Обработка поформированию ОРП подключается в дополнительные обработки и для нее настраивается расписание запуска.
Обоаботка ищет непроведенные документы ОРП, которые связаны с документом «Кассовая смена», со статусом «Закрыта».
И выполняет заполнение этих документов продажами из таблиц базы данных «Кассового сервера» Artix, подключенными в программу, как
внешние источники данных.
\end{quote}

\end{enumerate}

\sphinxAtStartPar
Настройки публикации базы

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{web}.png}
\end{figure}

\sphinxstepscope


\chapter{Внешняя программма}
\label{\detokenize{prox:id1}}\label{\detokenize{prox::doc}}
\sphinxAtStartPar
Внешняя программа реализована на языке Python и расположена на отдельном сервере с установленной серверной операционной системой Linux
Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0\sphinxhyphen{}69\sphinxhyphen{}generic x86\_64)

\sphinxAtStartPar
Программа состоит из двух блоков, первый отвечает за получение остатков товаров из обработки и передачи на кассовый сервер Artix,
второй за отслеживание открытия и закрытия смен на кассах и переодической передачи этих данных в УНФ.

\sphinxAtStartPar
\sphinxstylestrong{Общее описание}

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{1. Установка и настройка}

\sphinxAtStartPar
Программа стартует с блока «main». При старте проверяется наличие конфигурационного файла \DUrole{xref,std,std-ref}{strset} и
в случае его отсутствия прошрамма завершает свою работу выводя соообщения в файл логов. Если
файл настроек прочитан, то вызывается функция «main» и программа начинает работу.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{m\PYGZus{}conf} \PYG{o}{=} \PYG{n}{m\PYGZus{}config}\PYG{o}{.}\PYG{n}{m\PYGZus{}Config}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{rc} \PYG{o}{=}  \PYG{n}{m\PYGZus{}conf}\PYG{o}{.}\PYG{n}{loadConfig}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{rc} \PYG{o}{==} \PYG{k+kc}{None}\PYG{p}{:}
    \PYG{n}{main}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n}{logger}\PYG{o}{.}\PYG{n}{error}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Configuration file not found}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{logger}\PYG{o}{.}\PYG{n}{info}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The program has finished its work}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
Вначале происходит работа с кассовыми сменами

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{2. Кассовые смены}

\sphinxAtStartPar
После обработки кассовых смен, выполняется проверка и при необходимости загрузка остатков.

\sphinxAtStartPar
\DUrole{xref,std,std-ref}{3. Работа с остатками}

\sphinxstepscope


\chapter{Файлы}
\label{\detokenize{files:id1}}\label{\detokenize{files::doc}}\begin{quote}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Скачать эту документацию в pdf}}.
\end{quote}

\sphinxstepscope


\chapter{Порядок внедрения касс в работу с Артикс:}
\label{\detokenize{kass:id1}}\label{\detokenize{kass::doc}}

\section{1. Создать магазин + касса на сервере.}
\label{\detokenize{kass:id2}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Создание Магазина \sphinxhyphen{} Вводить Код, Название, Формат справочников (из 1С), метка дисконта (выбор из созданных)

\item {} \begin{description}
\sphinxlineitem{Создание Кассы \sphinxhyphen{} Вводить Код, Название, Хост (IP), Тип кассы (Рабочее место кассира), Формат выгрузки продаж (с КС в 1С), Категория справочников (если используется), Состояние обмена (рекоменд. Выключен).         При использовании Конфигураций \sphinxhyphen{} Выбрать конфигурацию, и окружение (для рабочей кассы \sphinxhyphen{} Боевое)}\begin{itemize}
\item {} 
\sphinxAtStartPar
Создать структуру Магазин\sphinxhyphen{}Кассы можно/нужно заранее.

\end{itemize}

\end{description}

\end{enumerate}


\section{2. Настройка ПОС}
\label{\detokenize{kass:id3}}
\sphinxAtStartPar
Полуручной:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Самый простой способ предварительно настроить 1 пос, и сохранить нужные файлы настроек (настройки, оборудование и т.д.). Далее скопировать на другую ПОС в требуемые директории.

\end{enumerate}

\sphinxAtStartPar
Автоматически:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Использовать менеджер\sphinxhyphen{}конфигураций (что есть в КС), одна тонкость \sphinxhyphen{} возможно не все настройки можно произвести через него.

\item {} 
\sphinxAtStartPar
Включить обмен на сервере и запустить полную выгрузку справочников с сервера. После полной прогрузки справочников \sphinxhyphen{} перезапустить кассовую программу на ПОС

\end{enumerate}

\sphinxstepscope


\chapter{Добавление группы сертификатов со сроком действия через REST API.}
\label{\detokenize{sert:rest-api}}\label{\detokenize{sert::doc}}
\sphinxAtStartPar
\sphinxstylestrong{1. Добавление группы сертификатов со сроком действия через REST API.}
\begin{enumerate}
\sphinxsetlistlabels{\alph}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Добавить группу сертификатов в БД КС, сформировав запрос типа POST на url: \sphinxurl{http:/}/\textless{}host\textgreater{}:\textless{}port\textgreater{}/Csrest/rest/dictionaries/certificates

\item {} 
\sphinxAtStartPar
Тело запроса в формате Json должно быть подобного формата:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}code\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}1\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}rangefrom\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{30}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}rangeto\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{40}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}Сертификаты\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}sum\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{300}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}inputmask\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+m+mi}{31}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}discountcampaign\PYGZdq{}}\PYG{p}{:}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}test campaign\PYGZdq{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Атрибут свойства  discountcampaign должен содержать yaml акции, в которой как раз можно указать сроки действия.
Напрример, если смотреть на уже существующую группу сертификатов, созданную вручную через web\sphinxhyphen{}интерфейс LM с указанием срока действия (БД КС ArtixAll, таблица certificateTemp), то в поле discountcampaign увидим запись вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{!!python/object:artixds.domain.DiscountCampaign}
\PYG{n+nt}{active}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{true}
\PYG{n+nt}{beginBonusesDateCalculate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{beginBonusesIntervalCondition}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{date}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginBonusesIntervalMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginBonusesIntervalValue}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{0}
\PYG{n+nt}{beginDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{beginDateWithBeginCurrentMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginDateWithBeginNextMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{beginRangeDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{2022\PYGZhy{}02\PYGZhy{}17}
\PYG{n+nt}{beginTime}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{checkedTags}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{daysOfWeek}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{p+pIndicator}{]}
\PYG{n+nt}{discounts}\PYG{p}{:}\PYG{+w}{ }\PYG{p+pIndicator}{[}\PYG{p+pIndicator}{]}
\PYG{n+nt}{endBonusesDateCalculate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{endBonusesIntervalCondition}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{date}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{endBonusesIntervalMetric}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{day}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{endBonusesIntervalValue}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{0}
\PYG{n+nt}{endDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{endRangeDate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{2022\PYGZhy{}02\PYGZhy{}17}
\PYG{n+nt}{endTime}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{id}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{57026161735168}
\PYG{n+nt}{interactionType}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{all}
\PYG{n+nt}{labels}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{manualActivate}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{name}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!python/unicode}\PYG{+w}{ }\PYG{l+s}{\PYGZsq{}}\PYG{l+s}{\PYGZsq{}}
\PYG{n+nt}{parent}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{parentGroup}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{priority}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{null}
\PYG{n+nt}{qualifiers}\PYG{p}{:}\PYG{+w}{ }\PYG{k+kt}{!!set}\PYG{+w}{ }\PYG{p+pIndicator}{\PYGZob{}}\PYG{p+pIndicator}{\PYGZcb{}}
\PYG{n+nt}{tagsIsAllowed}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{false}
\PYG{n+nt}{weight}\PYG{p}{:}\PYG{+w}{ }\PYG{l+lScalar+lScalarPlain}{300}
\end{sphinxVerbatim}

\sphinxAtStartPar
То есть в этом случае срок действия для группы сертификатов определен свойствами beginRangeDate и endRangeDate (от 2022\sphinxhyphen{}02\sphinxhyphen{}17 до 2022\sphinxhyphen{}02\sphinxhyphen{}17).

\sphinxAtStartPar
Берем этот Yaml как шаблон и изменияем даты beginRangeDate и endRangeDate на нужные.
\end{quote}

\item {} 
\sphinxAtStartPar
Далее  этот Yaml необходимо переделать в однострочный формат. Для этого после каждой строки добавляем rn, и переносим все строки в одну. В итоге должна получиться строка следующего вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
!python/object:artixds.domain.DiscountCampaign\PYGZbs{}r\PYGZbs{}nactive: true\PYGZbs{}r\PYGZbs{}nbeginBonusesDateCalculate: null\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalCondition: !!python/unicode \PYGZsq{}date\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginBonusesIntervalValue: 0\PYGZbs{}r\PYGZbs{}nbeginDate: null\PYGZbs{}r\PYGZbs{}nbeginDateWithBeginCurrentMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginDateWithBeginNextMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nbeginRangeDate: 2022\PYGZhy{}02\PYGZhy{}17\PYGZbs{}r\PYGZbs{}nbeginTime: null\PYGZbs{}r\PYGZbs{}ncheckedTags: null\PYGZbs{}r\PYGZbs{}ndaysOfWeek: []\PYGZbs{}r\PYGZbs{}ndiscounts: []\PYGZbs{}r\PYGZbs{}nendBonusesDateCalculate: null\PYGZbs{}r\PYGZbs{}nendBonusesIntervalCondition: !!python/unicode \PYGZsq{}date\PYGZsq{}\PYGZbs{}r\PYGZbs{}nendBonusesIntervalMetric: !!python/unicode \PYGZsq{}day\PYGZsq{}\PYGZbs{}r\PYGZbs{}nendBonusesIntervalValue: 0\PYGZbs{}r\PYGZbs{}nendDate: null\PYGZbs{}r\PYGZbs{}nendRangeDate: 2022\PYGZhy{}02\PYGZhy{}17\PYGZbs{}r\PYGZbs{}nendTime: null\PYGZbs{}r\PYGZbs{}nid: 62331387691573\PYGZbs{}r\PYGZbs{}ninteractionType: all\PYGZbs{}r\PYGZbs{}nlabels: null\PYGZbs{}r\PYGZbs{}nmanualActivate: null\PYGZbs{}r\PYGZbs{}nname: !!python/unicode \PYGZsq{}\PYGZsq{}\PYGZbs{}r\PYGZbs{}nparent: null\PYGZbs{}r\PYGZbs{}nparentGroup: null\PYGZbs{}r\PYGZbs{}npriority: null\PYGZbs{}r\PYGZbs{}nqualifiers: !!set \PYGZob{}\PYGZcb{}\PYGZbs{}r\PYGZbs{}ntagsIsAllowed: false\PYGZbs{}r\PYGZbs{}nweight: 300
\end{sphinxVerbatim}

\sphinxAtStartPar
И в таком виде эту строку можно добавить в тело POST\sphinxhyphen{}запроса (пункт 1.1) вместо записи  test campaign.
\end{quote}

\end{enumerate}

\sphinxAtStartPar
\sphinxstylestrong{2. Отправляем POST\sphinxhyphen{}запрос, указав данные для авторизации (как от  WEB  КЦ)}
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{1}.png}
\end{figure}
\end{quote}

\sphinxAtStartPar
Далее убеждаемся что запрос прошел без ошибок и проверяем в web\sphinxhyphen{}интерфейсе LM, что создалась группа сертификатов. Открываем эту группу на редактирование и убеждаемся, что сроки действия прописаны корректно.
\begin{quote}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{2}.png}
\end{figure}
\end{quote}

\sphinxAtStartPar
\sphinxstylestrong{3. Затем добавляем сертификат на сервер POST\sphinxhyphen{}запросом http://\textless{}хост\textgreater{}:\textless{}порт бонусного сервера/сервера сертификатов\textgreater{}/ACC/rest/v1/cards.}
\begin{quote}

\sphinxAtStartPar
Тело запроса должно быть вида:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}number\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}30\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}accountNumber\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}30\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{        }\PYG{n+nt}{\PYGZdq{}status\PYGZdq{}}\PYG{p}{:}\PYG{l+s+s2}{\PYGZdq{}EARN\PYGZus{}PAY\PYGZdq{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}
\end{quote}
\end{quote}

\sphinxAtStartPar
Важно, чтобы значения  number и  accountNumber входили в диапозон номеров созданной группы сертификатов.

\sphinxstepscope


\chapter{Работа с весами}
\label{\detokenize{scal:id1}}\label{\detokenize{scal::doc}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{tip}.png}
\end{figure}


\bigskip\hrule\bigskip


\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{load}.png}
\end{figure}

\sphinxAtStartPar
Пример файла выгрузки формируемый из 1С

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{l+m+mi}{82}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\PYG{l+m+mi}{2082}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{0.006}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\PYG{l+m+mi}{3082}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{0.008}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\PYG{l+m+mi}{4082}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{0.012}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\PYG{l+m+mi}{5082}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{0.02}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\PYG{l+m+mi}{6082}\PYG{p}{;}\PYG{n}{Шейки} \PYG{n}{цыплят} \PYG{n}{в}\PYG{o}{/}\PYG{n}{к}\PYG{p}{;}\PYG{p}{;}\PYG{l+m+mi}{550}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{0.014}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{10007}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mi}{0}\PYG{p}{;}\PYG{l+m+mf}{01.01}\PYG{l+m+mf}{.01}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{set4}.png}
\end{figure}
\subsubsection*{Настройка автоматического загрузчика}

\sphinxAtStartPar
\sphinxstyleemphasis{Указываем путь до файлов лога, включаем автоматический режим и устанавливаем интервал запуска.}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{set1}.png}
\end{figure}

\sphinxAtStartPar
\sphinxstyleemphasis{Формируем список весов для загрузки}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{set2}.png}
\end{figure}

\sphinxAtStartPar
\sphinxstyleemphasis{Настройка весов}

\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{set3}.png}
\end{figure}
\subsubsection*{Настройка весов}

\sphinxAtStartPar
Необходимо в весах установить префикс весового товара в \sphinxstylestrong{«20»}.
\subsubsection*{Настройки штрихкодирования на весах:}

\sphinxAtStartPar
Правила разбора штрих\sphinxhyphen{}кода фиксируются в конфигурационном файле \sphinxtitleref{/linuxcash/cash/conf/bcode.ini}
и применяются в заданном порядке. Также осуществляется считывание конфигурации bcodeparser из директории
\sphinxtitleref{/linuxcash/cash/conf/bcode.ini.d/} (считывание файлов происходит в алфавитном порядке).
Итоговая конфигурация выводится в основной лог программы \sphinxtitleref{/linuxcash/logs/current/terminal.log.}

\begin{sphinxadmonition}{attention}{Внимание:}
\sphinxAtStartPar
При указании правил разбора штрих\sphinxhyphen{}кода в конфигурационном файле \sphinxtitleref{/linuxcash/cash/conf/bcode.ini}
и в файлах директории \sphinxtitleref{/linuxcash/cash/conf/bcode.ini.d/}
сначала происходит считывание файла \sphinxtitleref{/linuxcash/cash/conf/bcode.ini.}
\end{sphinxadmonition}

\sphinxAtStartPar
Ссылка на сайт с \sphinxhref{https://docs.artix.su/pages/viewpage.action?pageId=27532556}{документацией} (рус.)

\sphinxstepscope


\chapter{Дополнительные материалы:}
\label{\detokenize{additional:id1}}\label{\detokenize{additional::doc}}

\section{1. Список директорий и файлов  основных настроек.}
\label{\detokenize{additional:id2}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} \begin{description}
\sphinxlineitem{/linuxcash/cash/conf/}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumii}{enumiii}{}{)}%
\item {} 
\sphinxAtStartPar
ncash.ini \sphinxhyphen{} основной файл настроек

\item {} 
\sphinxAtStartPar
bcode.ini  \sphinxhyphen{} правила разбора ШК

\item {} 
\sphinxAtStartPar
frinit.conf \sphinxhyphen{} инициализация ФР

\item {} 
\sphinxAtStartPar
cliche.txt и tail.txt \sphinxhyphen{} Клише/подвал чека

\item {} 
\sphinxAtStartPar
artixsb.conf

\end{enumerate}

\end{description}

\item {} \begin{description}
\sphinxlineitem{/linuxcash/cash/conf/ncash.ini.d/}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumii}{enumiii}{}{)}%
\item {} 
\sphinxAtStartPar
artixbonus.ini \sphinxhyphen{} работа с бонусным сервером

\item {} 
\sphinxAtStartPar
artixcertificate.ini

\item {} 
\sphinxAtStartPar
deferredcheck.ini \sphinxhyphen{} отложенные чеки

\item {} 
\sphinxAtStartPar
fr.ini

\item {} 
\sphinxAtStartPar
gui.ini \sphinxhyphen{} выбор интерфейса ПО

\item {} 
\sphinxAtStartPar
motp.ini \sphinxhyphen{} сигареты

\item {} 
\sphinxAtStartPar
markedgoods.ini \sphinxhyphen{} другая маркировка

\end{enumerate}

\end{description}

\item {} 
\sphinxAtStartPar
/linuxcash/cash/conf/drivers/ \sphinxhyphen{} Настройки подключения оборудования

\end{enumerate}

\sphinxAtStartPar
Сначала настраивается одна ПОС, полученные настройки используем как эталонные. После установки ПО на новую ПОС копируем настройки,
включая “Подключаемое оборудование”, проверяем и при необходимости вносим правки.


\section{2. Особенности настройки “Сбербанк”}
\label{\detokenize{additional:id3}}
\sphinxAtStartPar
Для работы с процессингом сбербанк необходимо установить пакет \sphinxhyphen{} \sphinxstyleemphasis{artix45\sphinxhyphen{}plugin\sphinxhyphen{}sb}.
В директорию \sphinxstylestrong{”/linuxcash/cash/paysystems/sb/“} разместить файлы приложения сбербанк полученного от сотрудников банка. Настроить подключение ПинПад согласно инструкции банка (pinpad.ini). Следует обратить внимание что при подключении пинпад через USB, необходимо правильно создать символьную ссылку на устройство:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ln} \PYG{o}{\PYGZhy{}}\PYG{n}{s} \PYG{o}{/}\PYG{n}{dev}\PYG{o}{/}\PYG{n}{serial}\PYG{o}{/}\PYG{n}{by}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{id}\PYG{o}{/}\PYG{p}{\PYGZob{}}\PYG{n}{Имя\PYGZus{}Устройства}\PYG{p}{\PYGZcb{}} \PYG{o}{/}\PYG{n}{linuxcash}\PYG{o}{/}\PYG{n}{cash}\PYG{o}{/}\PYG{n}{paysystems}\PYG{o}{/}\PYG{n}{sb}\PYG{o}{/}\PYG{n}{ttyS99}
\end{sphinxVerbatim}

\sphinxAtStartPar
Для работы с терминалом PAX SP30 \sphinxhyphen{} дополнительно установить пакет \sphinxstyleemphasis{ttypos}


\section{3. Ссылка на скачивание дистрибутива yuki}
\label{\detokenize{additional:yuki}}\begin{quote}

\sphinxAtStartPar
\sphinxurl{http://update.artix.su/static/yuki/}
\end{quote}


\section{4. Остатки}
\label{\detokenize{additional:id4}}
\sphinxAtStartPar
в конфигурационном файле /linuxcash/cash/conf/ncash.ini
Изменить:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{;}\PYG{n}{calculateRemainsOfGoods} \PYG{o}{=} \PYG{n}{false}
\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{p}{;}\PYG{n}{considerRemainsOfGoods} \PYG{o}{=} \PYG{n}{false}
\end{sphinxVerbatim}

\sphinxAtStartPar
на:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{calculateRemainsOfGoods} \PYG{o}{=} \PYG{n}{true}
\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}
\PYG{n}{considerRemainsOfGoods} \PYG{o}{=} \PYG{n}{true}
\end{sphinxVerbatim}

\sphinxAtStartPar
После изменения настроек надо перезапустить кассовое По.
Тогда касса будет считать остатки и учитывать их при продажи

\sphinxAtStartPar
Для товара, у которого не нужно контролировать остатки (кулинария) при выгрузке не указываем дату остатков \sphinxhyphen{} \sphinxstyleemphasis{remaindate}, а поле \sphinxstyleemphasis{remain}
оставляем \sphinxstylestrong{пустым!!!} (не «0»!!!).


\section{5. Дисконтные карты (создание)}
\label{\detokenize{additional:id5}}\begin{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
создать счет на бонусном сервере

\item {} 
\sphinxAtStartPar
привязать номер карты к счету

\item {} 
\sphinxAtStartPar
создать карту на кассовом сервере (группа должна быть создана заранее)

\end{enumerate}

\sphinxAtStartPar
1 и 2 это работа с апи бонусного сервера

\sphinxAtStartPar
3 это работа с файлом аиф, или через рестапи загрузки справочников с Кассовым севером.

\sphinxAtStartPar
\sphinxurl{https://docs.artix.su/pages/viewpage.action?pageId=27530936}
\end{quote}


\section{6. Настройка действий и контекста клавиш}
\label{\detokenize{additional:id6}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics{{key}.jpg}
\end{figure}


\section{7. Конфигурирование дистконтной системы}
\label{\detokenize{additional:id7}}
\sphinxAtStartPar
Ссылка на сайт с полной \sphinxhref{https://docs.artix.su/pages/viewpage.action?pageId=27531279\#id-Встроеннаядисконтнаяподсистема-Конфигурирование}{инструкцией}

\sphinxAtStartPar
Дисконтная система поставляется отдельным пакетом artix45\sphinxhyphen{}discountsystem.

\sphinxAtStartPar
Наличие минимальной цены влияет на методы распределения скидок на чек и наборы.
Минимальные цены не учитываются на этапе расчета скидок, дополнительное ограничение минимальной цены накладывается на этапе применения.

\sphinxAtStartPar
Сумма скидки на чек распределяется в два этапа:
\begin{itemize}
\item {} 
\sphinxAtStartPar
распределение по позициям пропорционально стоимости каждой позиции,

\item {} 
\sphinxAtStartPar
размещение остатка максимально возможными суммами начиная с первой позиции.

\end{itemize}

\sphinxAtStartPar
Правила распределения остатка определяется параметром \sphinxstylestrong{distributeReceiptDiscountFully} в конфигурационном файле \sphinxstyleemphasis{/linuxcash/cash/conf/ncash.ini в секции {[}Discount{]}:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
при значении параметра true остаток скидки распределяется максимально возможными суммами, учитывая ограничения минимальной ценой товара. Выполняется только первый этап распределения скидки;

\item {} 
\sphinxAtStartPar
при значении параметра false сумма скидки на чек распределяется по позициям пропорционально их стоимости.

\end{itemize}

\sphinxAtStartPar
Размер скидки на позицию ограничивается минимальной ценой товара. В случае предоставления скидок на наборы минимальную цену
на товары можно игнорировать для того, чтобы иметь возможность задавать акции вида «купи две штуки и одну получи в подарок»,
когда скидка назначается только на один из товаров. Возможность игнорирования минимальной цены при предоставлении скидки
на наборы задается параметром \sphinxstylestrong{ignoreMinimalPriceForKit} в конфигурационном файле \sphinxstyleemphasis{/linuxcash/cash/conf/ncash.ini в секции {[}Discount{]}:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
при значении параметра true минимальная цена при применении скидки на набор игнорируется,

\item {} 
\sphinxAtStartPar
при значении параметра false скидка на комплект будет предоставлена с учетом минимальной цены на товар.

\end{itemize}

\sphinxAtStartPar
В основе дисконтной системы заложена идея использования любых доступных элементов чека (товарная позиция, дисконтная карта и т.д.)
для проверки условий и вычисления ставок. Так как условия скидок могут быть сложными, то после изменения состава чека выполняется
отмена ранее примененных скидок, последующий пересчет и применение новых. Пересчет скидок может занимать продолжительное время,
это может происходить из\sphinxhyphen{}за недостатка ресурсов машины, на которой осуществляется работа, или из\sphinxhyphen{}за сложности самих скидок.
Кассовое ПО Artix может быть настроено таким образом, чтобы расчет скидок происходил как в процессе формирования чека,
так и только при переходе к оплате документа. Момент расчета скидок задается параметром \sphinxstylestrong{recalcDiscInFormingMode}
в конфигурационном файле \sphinxstyleemphasis{/linuxcash/cash/conf/ncash.ini в секции {[}Check{]}:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
при значении параметра true скидки пересчитываются в режиме формирования документа,

\item {} 
\sphinxAtStartPar
при значении параметра false скидки пересчитываются при переходе в подитог.

\end{itemize}

\sphinxAtStartPar
Если расчет скидок происходит в режиме формирования документа, то пересчет скидок выполняется после:
\begin{itemize}
\item {} 
\sphinxAtStartPar
добавления или сторнирования товарной позиции,

\item {} 
\sphinxAtStartPar
добавления или удаления карты,

\item {} 
\sphinxAtStartPar
изменения модификаторов (цена, количество и т.п.) товарной позиции.

\end{itemize}

\sphinxAtStartPar
При использовании акций со ставкой 0\% (например, рекламных) можно контролировать запись информации о сработавшем дисконтном
воздействии на позицию в БД \sphinxstyleemphasis{Documents} таблицу \sphinxstyleemphasis{Discitem}. Возможность сохранения скидки 0\% на позицию
в БД задается параметром \sphinxstylestrong{saveNullDiscountForPosition} в конфигурационном файле \sphinxstyleemphasis{/linuxcash/cash/conf/ncash.ini в секции {[}Discount{]}:}
\begin{itemize}
\item {} 
\sphinxAtStartPar
при значении параметра true скидки 0\% на позицию сохраняются в БД,

\item {} 
\sphinxAtStartPar
при значении параметра false скидки 0\% на позицию не сохраняются в БД.

\end{itemize}


\begin{savenotes}\sphinxattablestart
\sphinxthistablewithglobalstyle
\centering
\begin{tabular}[t]{\X{15}{85}\X{10}{85}\X{15}{85}\X{30}{85}\X{15}{85}}
\sphinxtoprule
\sphinxstyletheadfamily 
\sphinxAtStartPar
Наименование
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Тип данных
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Возможные значения
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Описание
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Примечания
\\
\sphinxmidrule
\sphinxtableatstartofbodyhook
\sphinxAtStartPar
distributeReceiptDiscountFully
&
\sphinxAtStartPar
логический
&
\sphinxAtStartPar
true, false
&
\sphinxAtStartPar
Полностью распределять по позициям сумму скидки на чек
&
\sphinxAtStartPar
По умолчанию true
\\
\sphinxhline
\sphinxAtStartPar
ignoreMinimalPriceForKit
&
\sphinxAtStartPar
логический
&
\sphinxAtStartPar
true, false
&
\sphinxAtStartPar
Игнорировать минимальную цену при применении скидки на комплект
&
\sphinxAtStartPar
По умолчанию true
\\
\sphinxhline
\sphinxAtStartPar
recalcDiscInFormingMode
&
\sphinxAtStartPar
логический
&
\sphinxAtStartPar
true, false
&
\sphinxAtStartPar
Пересчитывать скидки в режиме формирования чека
&
\sphinxAtStartPar
По умолчанию true
\\
\sphinxhline
\sphinxAtStartPar
saveNullDiscountForPosition
&
\sphinxAtStartPar
логический
&
\sphinxAtStartPar
true, false
&
\sphinxAtStartPar
Сохранять скидку 0\% на позицию в базу данных
&
\sphinxAtStartPar
По умолчанию false
\\
\sphinxbottomrule
\end{tabular}
\sphinxtableafterendhook\par
\sphinxattableend\end{savenotes}

\sphinxAtStartPar
S

\sphinxAtStartPar
\sphinxstylestrong{Пример настроек}

\def\sphinxLiteralBlockLabel{\label{\detokenize{additional:id9}}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{[Discounts]}
\PYG{c+c1}{;}
\PYG{c+c1}{; Скидки}
\PYG{c+c1}{;}
\PYG{n+na}{...}
\PYG{c+c1}{; Полностью распределять по позициям сумму скидки на чек}
\PYG{n+na}{distributeReceiptDiscountFully}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s}{false}
\PYG{n+na}{...}
\PYG{c+c1}{; Сохранять скидку 0\PYGZpc{} на позицию в базу данных}
\PYG{n+na}{saveNullDiscountForPosition}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s}{true}
\PYG{c+c1}{; Игнорировать минимальную цену при применении скидки на комплект}
\PYG{n+na}{ignoreMinimalPriceForKit}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s}{false}

\PYG{k}{[Check]}
\PYG{c+c1}{;}
\PYG{c+c1}{; Настройки чека}
\PYG{c+c1}{;}
\PYG{n+na}{...}
\PYG{c+c1}{; Пересчитывать скидки в режиме формирования чека, по\PYGZhy{}умолчанию true.}
\PYG{n+na}{recalcDiscInFormingMode}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+s}{true}
\end{sphinxVerbatim}


\chapter{Индексы и таблицы}
\label{\detokenize{index:id1}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}

\sphinxAtStartPar
Что реализовать:

\begin{sphinxadmonition}{note}{План:}
\sphinxAtStartPar
Планируется добавить модуль контроля товаро\sphinxhyphen{}остатков пришедших из \DUrole{xref,std,std-term}{УНФ} и выгруженных в кассовый сервер
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{description:id2}]{\sphinxcrossref{\sphinxstyleemphasis{исходный элемент}}}} находится в /home/bat/Project/docs/Artix\_Global/source/description.rst, строка 52.)



\renewcommand{\indexname}{Алфавитный указатель}
\printindex
\end{document}