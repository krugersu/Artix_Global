:orphan:

3. GetProductRemains
--------------------

Сервис предназначен для обработки данных по кассовым сменам. С его помощью открываются и закрываются кассовые смены.

**Пример запроса**

::

    http://192.168.252.250:8082/unf_vz_const/hs/Workshift/V1/post_workshop_open

**Структура запроса**

::    

    http://{Адрес сервера}/{Имя БД}/hs/{Имя}/V1/{Параметр}

Где:

    Адрес сервера - адрес сервера где опубликована база

    Имя БД - Имя опубликованной базы

    Имя - Имя запроса

    Параметр - Параметр запроса


Запрос может принимать два параметра:

#. "post_workshop_open" - открытие смены
#. "post_workshop" - закрытие смены


**Описание**

``Запрос с параметром "post_workshop_open"``

В теле запроса передаются данные открытой в Artix смены вида:

::

[[195, "test", "2023-04-20 11:47:29", "test", 291]]

где

::

[["номер смены ккт", "код кассы", "дата время открытия смены", "код магазина", "id кассовой смены"]]


:term:`УНФ` получает запрос, преобразует тело запроса в массив и вызывает процедуру 

.. function:: ОткрытьКассовыеСмены(ДанныеСменККМ)
    
    передавая в нее данные полученные в запросе.В процедуре массив разбирается на составляющие и вызывается процедура

.. function:: СоздатьКассовуюСмену(тНомерСмены, тНомерМагазина,тДатаОткрытия,тКассаАртикс,workshiftid)
    
    с данными кассовой смены. В этой процедуре выполняется проверка на то что смена с такими параметрами уже существует [1]_ и если нет, то создается новая касоовая смена со статусом "Открыта".


``Запрос с параметром "post_workshop"``

В теле запроса передаются данные закрытой в Artix смены вида:

::

    [[195, "test", "2023-04-20 12:43:20", "test", "2023-04-20 11:47:29", 291, 
    "_shop_test_56f60925", "_cash_test_e0146422", "3", 1, 1, "264.1000",
    "264.1000", "264.1000", "2023-04-20 11:47:22", "264.10", "0.00", "0.00",
    "264.10", "0.00", "0.00", "0.00", "0.00", 1, 0]]

где

::

    [["номер смены ккт", "код кассы", "дата время закрытия смены", "код магазина", 
    "дата время открытия смены", "id кассовой смены", "id магазина", "id кассы",
    "Код кассира", "Номер первого чека в смене", "Номер последнего чека в смене",
    "Сумма продажи", "Сумма выручки", "Сумма в денежном ящике",
    "Дата и время открытия первого чека в смене", "Сумма продажи (наличные)",
    "Сумма продажи (безналичные)", "Сумма продажи (прочие)", "Сумма выручки (наличные)",
    "Сумма выручки (безналичные)", "Сумма возвратов", "Сумма возвратов (наличные)",
    "Сумма возвратов (безналичные)", "Количество чеков продажи"]]


:term:`УНФ` получает запрос, преобразует тело запроса в массив и вызывает процедуру 

.. function:: ЗакрытьКассовыеСмены(ДанныеСменККМ)
    
    передавая в нее данные полученные в запросе.В процедуре массив разбирается на составляющие и вызывается процедура

.. function:: ЗакрытьСмену(тНомерСмены, тНомерМагазина,тДатаЗакрытия,тКасса,тДатаОткрытия,тКассаАртикс,workshiftid)
    
    с данными кассовой смены. В этой процедуре выполняется проверка на то что смена с такими параметрами уже существует [1]_ и найденный документ заполняется переданными данными,
    если нет, то она создается  со статусом "Открыта".
    Затем кассовая смена закрывается.

В случае удачного завершения работы сервис возвращает код "200", в противном варианте вернется код ошибки.



В случае удачного завершения работы сервис возвращает код "200", в противном варианте вернется код ошибки.

-----

.. [1] Поиск производится по уникальному идентификатору смены "workshiftid". Этот реквизит был добавлен в документ "Кассовая смена".


