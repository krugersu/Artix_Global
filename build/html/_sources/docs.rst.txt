Сайт с документацией
====================

Разворачивание сайта:
---------------------

Git должен уже быть установлен в системе -  :ref:`gitinst`

1. Копирование Git репозитория.
"""""""""""""""""""""""""""""""

.. code-block:: bash

    $ mkdir ~/Doc
    $ cd Doc/
    $ git clone https://github.com/krugersu/Artix_Global


2. Установка Apache.
""""""""""""""""""""

Ссылка на сайт с полной инструкцией_ 

.. _инструкцией: https://www.8host.com/blog/ustanovka-veb-servera-apache-v-ubuntu-22-04/



Установка без настройки брандмауэра.

Установка:
~~~~~~~~~

.. code-block:: bash

    $ sudo apt update
    $ sudo apt install apache2
    $ sudo systemctl status apache2

Получаем вывод вида:    


.. code-block:: bash

    apache2.service - The Apache HTTP Server
    Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
    Active: active (running) since Thu 2020-04-23 22:36:30 UTC; 20h ago
        Docs: https://httpd.apache.org/docs/2.4/
    Main PID: 29435 (apache2)
        Tasks: 55 (limit: 1137)
    Memory: 8.0M
    CGroup: /system.slice/apache2.service
            ├─29435 /usr/sbin/apache2 -k start
            ├─29437 /usr/sbin/apache2 -k start
            └─29438 /usr/sbin/apache2 -k start

Согласно этому выводу сервис успешно запустился. Но лучше ещё запросить страницу Apache, чтобы убедиться, что веб-сервер работает правильно.


3. Управление процессами Apache.
""""""""""""""""""""""""""""""""

Чтобы остановить веб-сервер, введите:

.. code-block:: bash

    $ sudo systemctl stop apache2

Запустить:

.. code-block:: bash

    $ sudo systemctl start apache2

Перезапуск:

.. code-block:: bash

    $ sudo systemctl restart apache2

По умолчанию Apache добавлен в автозагрузку.


4. Настройка виртуальных хостов.
""""""""""""""""""""""""""""""""

На веб-сервере Apache вы можете использовать виртуальные хосты (в Nginx это блоки server) для изоляции настроек и
размещения нескольких доменов на одном сервере. Здесь используется условный домен example.com, который нужно заменить доменом вашего сайта.

В Ubuntu 22.04 веб-сервер Apache по умолчанию предоставляет один включенный виртуальный хост,
который обслуживает каталог /var/www/html. Этого хватит для работы одного сайта, но если вы хотите
разместить несколько сайтов, вам нужно создать новые виртуальные хосты. Создайте структуру каталогов
в /var/www для сайта example.com, а /var/www/html оставьте как каталог по умолчанию, который будет
обслуживаться, если запрос клиента не соответствует другим сайтам.

Создайте каталог для your_domain:

.. code-block:: bash

    $ sudo mkdir /var/www/krudoc

Затем укажите права на каталог с помощью переменной $USER:

.. code-block:: bash

    $ sudo chown -R $USER:$USER /var/www/krudoc

Права должны быть предоставлены, если вы не меняли значение umask, которое устанавливает права файлов по умолчанию. Чтобы убедиться,
что права предоставлены и пользователь может работать с файлами, нужно ввести команду:    

.. code-block:: bash

    $ sudo chmod -R 755 /var/www/krudoc


Далее копируем содержимое каталога  `~/Doc/Artix_Global/build/html` в  `/var/www/krudoc`

.. code-block:: bash

    $ cp -r ~/Doc/Artix_Global/build/html/.  /var/www/krudoc


Нужно создать файл виртуального хоста с правильными директивами, чтобы Apache мог обслуживать этот контент.
Чтобы напрямую не изменять файл конфигурации по умолчанию, расположенный
в `/etc/apache2/sites-available/000-default.conf`, мы создадим новый в `/etc/apache2/sites-available/your_domain.conf``:    

.. code-block:: bash

    $ sudo nano /etc/apache2/sites-available/krudoc.conf


Вставьте в файл следующий блок настроек. Он похож на конфигурации по умолчанию, но содержит правильный домен и каталог:    


.. code-block:: bash

    <VirtualHost *:80>
        ServerAdmin pk69@kruger.su
        ServerName krudoc
        ServerAlias www.krudoc
        DocumentRoot /var/www/krudoc
        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
    </VirtualHost>

Обратите внимание, мы обновили DocumentRoot на наш новый каталог, а ServerAdmin на адрес электронной почты,
к которому может получить доступ администратор сайта your_domain. Также мы добавили две директивы: ServerName,
которая устанавливает базовый домен, который должен соответствовать этому определению виртуального хоста,
и ServerAlias – определяет дополнительные имена, которые должны соответствовать базовому имени.

После того, как закончите, сохраните и закройте файл.

Включим файл с помощью a2ensite:

.. code-block:: bash

    $ sudo a2ensite krudoc.conf

Отключите сайт по умолчанию, определенный в 000-default.conf:

.. code-block:: bash

    $ sudo a2dissite 000-default.conf
    $ systemctl reload apache2


Далее проверим ошибки настроек:

.. code-block:: bash

    $ sudo apache2ctl configtest

Вывод должен быть следующим:

.. code-block:: bash

    $ Syntax OK


Перезапустите Apache, чтобы изменения вступили в силу:

.. code-block:: bash

    $ sudo systemctl restart apache2

Теперь Apache должен обслуживать ваше доменное имя. Для проверки перейдите по адресу http://krudoc, вы должны увидеть что-то вроде этого:    



5. Важные файлы и каталоги Apache.
""""""""""""""""""""""""""""""""""

Контент

#. `/var/www/html`: Фактический веб-контент, который по умолчанию состоит только из стандартной
страницы Apache (ранее вы её уже видели), обслуживается из каталога `/var/www/html`. Это можно изменить,
внеся корректировки в файлы конфигурации Apache.


Настройка сервера

#. `/etc/apache2`: каталог конфигурации Apache. Все файлы настроек Apache находятся здесь.
#. `/etc/apache2/apache2.conf`: основной файл настройки Apache. Его можно корректировать
    для внесения изменений в глобальную конфигурацию Apache. Этот файл отвечает за загрузку
    многих других файлов в каталоге конфигурации.
#. `/etc/apache2/ports.conf`: В этом файле указаны порты, которые прослушивает Apache.
    По умолчанию Apache прослушивает порт 80 и дополнительно порт 443, если включен SSL.
#. `/etc/apache2/sites-available/`: каталог, в котором могут храниться виртуальные хосты
    для каждого сайта. Apache не будет использовать файлы настроек из этого каталога,
    если они не связаны с каталогом sites-enabled. Обычно вся конфигурация блока выполняется
    в этом каталоге, а затем включается путем ссылки на другой каталог с помощью команды a2ensite.
#. `/etc/apache2/sites-enabled/`: каталог, в котором хранятся включенные виртуальные хосты
    для каждого сайта. Обычно они создаются по ссылке на файлы настроек из каталога sites-available
    с помощью команды *a2ensite*. Apache считывает конфигурационные файлы и ссылки, находящиеся
    в этом каталоге, при запуске или перезагрузке для компиляции полной настройки.
#. `/etc/apache2/conf-available/`, `/etc/apache2/conf-enabled/`: Эти каталоги имеют те же отношения,
    что и каталоги `sites-available`и `ites-enabled`` но используются для хранения фрагментов настроек,
    которые не принадлежат виртуальному хосту. Файлы в каталоге `conf-available` можно включить
    с помощью команды *a2enconf*, а отключить – *a2disconf*.
#. `/etc/apache2/mods-available/`, `/etc/apache2/mods-enabled/`: эти каталоги содержат доступные
    и включенные модули соответственно. Файлы, заканчивающиеся на .load, содержат фрагменты для
    загрузки определенных модулей, а которые заканчиваются на .conf, содержат настройки этих модулей.
    Модули можно включать и отключать с помощью команд *a2enmod* и *a2dismod*.

Логи сервера

#. `/var/log/apache2/access.log`: каждый запрос к вашему веб-серверу записывается в этот лог по умолчанию,
    если Apache не настроен иначе.
#. `/var/log/apache2/error.log`: по умолчанию все ошибки записываются в этот файл.
    Директива LogLevel в конфигурации Apache определяет, насколько подробную информацию будут содержать журналы ошибок.

